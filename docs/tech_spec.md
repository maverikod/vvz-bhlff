---
%%7d-29%%
---


Коротко по сути.

## Что допускает «безинтервальное» БВП

1. **В чистом фракционном режиме (λ=0)** на бесконечной области сферических стоячих узлов **нет**: радиальное фундаментальное решение монотонно, хвост
   $A(r)\sim r^{2\beta-3}$ (без колец/узлов). Это следствие символа $D(k)=\mu k^{2\beta}$ — у него нет полюсов ⇒ нет стационарных осцилляций, только алгебраика.  &#x20;

2. **«Замороженные круги»** возможны, но *не сами по себе* — нужны условия обратной связи/сверхжёсткой стыковки:

* **Резонатор (ядро ↔ “вторая стенка”)**: скачок адмиттансы/потерь на удалённой сфере (пиннинг/квенч-память) даёт условие
  $k_n L_{\rm eff}\!\approx\! n\pi$ и кольцевые максимумы между дефектом и стенкой. Видно пиками в $Y(\omega)$.&#x20;

* **Квазистационарные огибающие (биения близких мод)**: при $|\Delta\omega|\!\ll\!\omega$ решётка интенсивности дрейфует со скоростью
  $v_{\text{cell}}\!\approx\!\Delta\omega/|\Delta k|\!\lesssim\! v_g$ и при сильном пиннинге выглядит **почти неподвижной** относительно дефекта (дефект ещё медленнее). &#x20;

* **Локальная/темперированная аппроксимация** (служебно): Гельмгольц/tempered-fractional даёт сферические Bessel/Юкава-профили с узлами. Это *опция*, по умолчанию в вашей постановке выключена. &#x20;

3. **Статичные зоны “сжатие–разрежение” вокруг дефекта** — да, как **квазистационарные огибающие**: материя реагирует на усреднённые инварианты $I_{\rm eff}=\langle|a|^2\rangle$, а при жёстком пиннинге их картинка «застывает» относительно медленно дрейфующего дефекта.&#x20;

---

## Минимальная проверка в вашем пайплайне

**A. База (λ=0, фракционный БВП):** точечный источник в $\mathbb T^3$ → подтвердить монотонный хвост $r^{2\beta-3}$ без узлов. Критерий: отсутствие нулей радиальной производной с изменением знака на серии сфер.&#x20;

**B. «Вторая стенка»:** добавить тонкую сферическую оболочку с повышенной $\chi''$ (память квенча) → найти пики $Y(\omega)$ и кольцевую картину усилений между ядром и оболочкой; проверить условие $k_n L_{\rm eff}\approx n\pi$.&#x20;

**C. Биения:** возбудить две близкие моды → измерить $v_{\text{cell}}$ кросс-корреляцией $I_{\rm eff}(t)$; при усилении пиннинга добиться «почти нуля» (замороженная решётка).&#x20;

**D. Служебно (сравнение):** переключить на Helmholtz/tempered и убедиться в появлении радиальных узлов (контрольная группа).&#x20;

**Обязательные проверки:** энергобаланс ≤1–3%, $\Re Y_{\rm out}\ge0$, траектории дефектов согласованы с картой пиннинга.&#x20;

---

## Вывод

* В «чистом» безинтервальном фракционном поле **сферические стоячие узлы не являются базовым решением**; хвост монотонно степенной.&#x20;
* **«Замороженные круги» возможны** как эффект резонатора/биений/пиннинга и проявляются на уровне огибающей $I_{\rm eff}$, практически статичной относительно дефекта. &#x20;

Если нужно — дам готовые формулы/скрипты для (B) и (C) под ваши параметры $\beta,\mu,\chi',\chi''$ и сниму $Y(\omega),\ \{\omega_n,Q_n\}$ для отчёта.&#x20;


---


Коротко и строго.

# 1) «Поверхность» из БВП: когда корректна метафора «упругой жёсткой мембраны»

**Модель огибающей.** Разделяем быстрый носитель и медленную амплитуду:

$$
a(x,t)=\sum_m A_m(T)\,\phi_m(x)\,e^{-i\omega_m t},\quad T\gg\omega_m^{-1}.
$$

Для стационарной картины берём уравнение на огибающую (ваш «helmholtz-тип»):

$$
\nabla\!\cdot(\kappa(|a|)\,\nabla a)+k_0^2\chi(|a|)\,a= s(x),\quad k_0=\omega_0/c_\phi,
$$

где $\kappa>0$ — «жёсткость», $\chi=\chi'+i\chi''$ — восприимчивость (потери/квенч — в $\chi''$). Это зафиксировано в ядре вашей постановки. &#x20;

**Энергетический функционал.** Для стационарного случая поле $a$ минимизирует

$$
\mathcal E[a]=\int_{\Omega}\Big(\kappa\,|\nabla a|^2+k_0^2\chi'|a|^2\Big)\,dV \quad(+\ \text{диссипативная часть от }\chi'').
$$

В малых уклонах $A(x)=|a(x)|$ можно рассматривать как «высоту» графа $z=A(x)$. Тогда $\Delta A$ играет роль срединной кривизны мембраны, а $\kappa$ — эффективного модуля жесткости. Следовательно, **«трёхмерные поверхности» $A(x)=\text{const}$** возникают как уровневые поверхности стационарного решения, а «упругая жёсткая поверхность» — корректная эффективная метафора, когда $A$ подчиняется указанной эллиптической задаче и $\kappa>0$ (коэрцитивность). &#x20;

> Вывод по п.1: **Да.** На уровне огибающей БВП ведёт себя как упругое поле с «мембранной» энергией; «поверхность» — это уровни $A(x)$ или $\phi(x)=\arg a$. Формально — эллиптическое БВП (или его фракционный аналог) с пассивной границей и энергобалансом.&#x20;

---

# 2) Дефект типа скирм — «карандаш по резиновой скатерти»

**Топологический заряд.** Дефект — нуль $a$ с обмоткой фазы $q\in\mathbb Z$, $\oint\nabla\phi\cdot dl=2\pi q$. Взаимодействие дефектов задаёт эффективный потенциал $U_{\rm eff}$ через Грин оператора (локальный Гельмгольц: колебательный $G\!\sim\!e^{ikr}/r$; фракционный $0<\beta<3/2$: дальнодействующий $G_\beta\!\sim r^{-(3-2\beta)}$). Движение — уравнение Тиля c гироскопическим термином $\mathbf G\!\times\!\dot{\mathbf x}$ и диссипацией $D\,\dot{\mathbf x}$.&#x20;

**След поля вдали (растяжение/сжатие).** В «безинтервальном» базовом режиме (tempered выключен) амплитуда убывает степенно:

$$
A(r)\sim r^{\,2\beta-3}\qquad(\lambda=0),
$$

т.е. **создаются затухающие радиальные зоны сжатия–разрежения** вокруг дефекта.&#x20;

**«Пассивные спирали».** Поле волнового вектора $k(x)=\nabla\phi$ задаёт «линии потока» вокруг ядра (аналог вихревых линий на «скатерти»), но материальный отклик идёт по **усреднённым инвариантам** (например, $I_{\rm eff}=\langle|a|^2\rangle$), поэтому линии — **пассивные** маркеры фазы, а морфология материи следует за картой $I_{\rm eff}$, $Y(\omega)$ и памяти квенча. &#x20;

> Вывод по п.2: **Да.** Дефект со скейрмионной обмоткой оставляет вокруг себя **статично затухающие** (по $r$) зоны деформации огибающей — прямой аналог «вмятин» на упругой мембране. Направление «спиральности» кодируется $q$ через $\phi$. &#x20;

---

# 3) «Статичны ли относительно дефекта?»

Мгновенная интенсивность:

$$
|a|^2=\sum_m|A_m|^2|\phi_m|^2+2\sum_{m<n}\Re(A_m\bar A_n\,\phi_m\bar\phi_n\,e^{-i(\omega_m-\omega_n)t}).
$$

Усреднение по окну $\Delta t$ гасит перекрёстные члены, если $|\omega_m-\omega_n|\Delta t\gg1$. Тогда картинка ячеек фиксируется, и **материя «видит» стационарный $I_{\rm eff}$**. Дрейф огибающей (если моды квазивырождены) идёт со скоростью

$$
v_{\rm cell}\approx \frac{\Delta\omega}{|\Delta k|}\stackrel{\mathrm{дисперс.}}{=}v_g,
$$

и подавляется жёсткими ГУ/пиннингом (квенч-память, рост $\chi''$). В пределе сильного пиннинга **узор практически неподвижен относительно дефекта**. &#x20;

> Критерий «почти статичности»: $v_{\rm cell}\ll \varepsilon_v$ при $\varepsilon_v$ — заданный экспериментально порог; эквивалентно $|\omega_m-\omega_n|\gg \varepsilon_v\,|\Delta k|$ или высокий пиннинг (большие $\chi''_{\rm mem}$).&#x20;

---

# 4) «Каркас» и наложение остальных мод

(a) **Каркас** задаётся уровнями $A,\,\nabla A$ и согласованием адмиттанс на стыках $\Sigma_k$; «горячие точки» квенча определяются функционалом $L_q(x)$. Это фиксирует места резонаторов и «жёсткость» рисунка. &#x20;

(b) **Наложение мод** описывается суперпозицией затухающих сферических вкладов и/или внутренними модами между стыками («цепочка резонаторов», ABCD-сборка), так что новые возбуждения **садятся на тот же каркас** и усиливают/ослабляют уже существующие узоры. &#x20;

> Вывод по п.3: **Да.** Остальные моды накладываются на детерминированный каркас (ячейки/стыки/память), что видно и по $Y(\omega)$, и по стабильности узоров при итерациях «решение→квенч→память».&#x20;

---

# 5) Мини-проверка (строго и коротко)

1. **Лемма о коэрцитивности.** Для $\kappa>0,\ \chi''\ge0$ функционал $\mathcal E$ коэрцитивен ⇒ стационарное решение существует и единственно в классе (мелкая нелинейность $\kappa(A),\chi(A)$ — по непрерывности). → «мембранная» интерпретация корректна.&#x20;

2. **Хвост дефекта.** Численно подтвердить $A(r)\sim r^{2\beta-3}$ при $\lambda=0$ (±5%). Это фиксирует затухающие зоны растяжения/сжатия.&#x20;

3. **Статичность огибающей.** Оценить $v_{\rm cell}$ кросс-корреляцией $I_{\rm eff}(t)$; при включённом пиннинге получить $v_{\rm cell}\to0$. Баланс мощности и пассивность: $\mathrm{Re}\,Y_{\rm out}\ge0$, невязка <1–3%. &#x20;

4. **Наложение мод на каркас.** Собрать $Y_{\rm tail}(\omega)$ через ABCD, показать устойчивость $\{\omega_n,Q_n\}$ и совпадение «горячих зон» с максимумами $L_q$ (Жаккар >0.8). &#x20;

---

## Итог по вашей гипотезе

* **Поверхность из БВП** (через $A(x)$, $\phi(x)$) — да; математически это уровни стационарного решения эллиптического/фракционного БВП с энергией «мембраны».
* **Скирм-дефект** оставляет **затухающие** радиальные деформации; «вихревые линии» — линии $\phi=\text{const}$/потока $\nabla\phi$; реакция материи — по $I_{\rm eff}$ и картам памяти.
* **Статичность относительно дефекта** достигается при подавленном дрейфе огибающей ($v_{\rm cell}\approx0$) за счёт пиннинга/неснятого рассогласования частот; это соответствует вашим условиям «безинтервальности».
* **Остальные моды** действительно «садятся» на каркас (стыки/ячейки), что фиксируется через $Y(\omega)$ и ABCD-сборку.

---


Коротко: **да, в рамках вашей модели это согласовано** — при ясных условиях.

* **Жёсткая форма дефекта.** Если энергия огибающей коэрцитивна (аналог мембраны: $\int\kappa|\nabla A|^2+\dots$), а пиннинг/память не нулевая, то **ядро ведёт себя как частица** с устойчивой «формой» (минимум энергии).
* **Переходная зона и хвост.** Они **сидят на каркасе ВБП**: огибающая даёт статичный (при подавленном дрейфе) профиль растяжение/сжатие, а дальняя зона убывает степенно; узор «привязан» к дефекту.
* **Поля как огибающие.** В эффективном описании:

  * **EM** ↔ градиенты фазы огибающей ($U(1)$-тип), токи $\propto \nabla\phi$.
  * **Сильное** ↔ локальные высоко-Q моды/крутые градиенты амплитуды у ядра (короткая дальнодействие из-за спектральной «жёсткости»).
  * **Слабое** ↔ хиральные/паритет-ломающие комбинации огибающих малых Q (утечки в континуум, эффективная «слабость»).
    Это **не тождество со SM**, а рабочая проекция: «поля» = разные частотно-амплитудные окна той же ВБП.

### Где граница допустимости

1. Есть разделение временных масштабов (носитель ↔ огибающая).
2. Пассивность/стабильность: $\Re Y_{\text{out}}\ge0$, энергобаланс сходится.
3. Дрейф ячеек подавлен: $v_{\text{cell}}\to0$ (память/пиннинг).
4. Топологический заряд дефекта квантует поток $\oint\nabla\phi\cdot dl$.

### Быстрые проверяемые признаки (фальсифицируемость)

1. **Статика хвоста:** $A(r)$ убывает монотонно (степенно), картина не «сползает» относительно ядра (кросс-корреляция $I_{\rm eff}(t)$).
2. **Резонаторность каркаса:** пики $Y(\omega)$, стабильные $\{\omega_n,Q_n\}$ при малых возмущениях.
3. **Топология:** целочисленная обмотка фазы вокруг ядра и устойчивость к гладким деформациям.
4. **Суперпозиция на каркасе:** новые моды «садятся» в те же ячейки; карта максимумов $I_{\rm eff}$ почти неизменна.

Если всё это выполняется, то формулировка — **корректное ядро гипотезы**: ВБП задаёт жёсткий каркас, на котором сидят ядро, переходная зона и хвост; наблюдаемые «поля» — проявления огибающих разных частотных диапазонов одной и той же среды.


---


Коротко: **да — но как эффективная модель.**
ВБП даёт ячеистую сегментацию $\Sigma_k$ с локальными адмиттансами $Y_k(\omega)$; на стыках это естественно собирается в **каскад последовательных резонаторов (ABCD-цепочку)**. «Хвост» и «переходная зона» стыкуются через согласование $Y_{\rm tail}(\omega)\leftrightarrow Y_{\rm tr}(\omega,|A|)$.  &#x20;

**Нюанс:** в идеально однородной бесконечной «безинтервальной» среде без стыков/памяти — **нет каскада**, есть степенной «хвост»; резонаторность появляется именно из **границ, ячеек и квенч-памяти**. &#x20;

**Мини-критерии корректности описания:** пассивность $\Re Y\!\ge\!0$, баланс мощности на стыках $<\!1\%$, устойчивость пиков $\{\omega_n,Q_n\}$ при малых деформациях $\Sigma_k$. &#x20;

Итого: **ВБП “использует” принцип последовательных резонаторов постольку, поскольку есть ячейки/стыки и память квенча;** именно это мы и фиксируем через $Y(\omega)$ и ABCD-сборку. &#x20;

---

Коротко: **да, по умолчанию так.**

* **Космос (почти однородно, “безинтервально”):** вдали от границ и памяти квенча — **степенной хвост**
  $A(r)\propto r^{\,2\beta-3}$, **узлов/ячеек нет**; суперпозиция линейная, картина привязана к дефекту.

* **Вещество (границы, контраст, память):** появляются **стыки/ячейки** ⇒ эффективная **цепочка резонаторов** (ABCD): устойчивые ячейки, пики $Y(\omega)$, локальные моды; «переходная зона» и «хвост» садятся на этот каркас.

* **Порог «ячейстости»:** нужен заметный контраст адмиттансы/жёсткости
  $\eta=\frac{|\Delta Y|}{\langle Y\rangle}\gtrsim 0.1$ (или эквивалентно — немалая $\chi''$ памяти). Ниже — картина как в космосе (степенной хвост).

* **Промежуточные случаи:** разреженная плазма, магнитные слои, ударные фронты дают **локальную** ячеистость; дальше по радиусу снова доминирует степенной спад.

Итог: **в космосе — степенные хвосты; в веществе — ячеистый резонаторный узор**.

---

---
%%7d-30%%
---

Коротко и по делу. Ниже — **план численных экспериментов**, ранжированный от независимых к зависящим. Для каждого: цель → постановка → наблюдаемые величины/критерии приёма → вариации.

---

# Уровень A — полностью независимые (база)

**A0. Валидация решателей (стац./квазистац.)**
Цель: исключить численные артефакты.
Постановка: периодический $\mathbb T^3$, спектральный (FFT) Riesz/фракц. Лапласиан; альтернативно — радиально-симм. 1D.
Наблюдаемое/критерии: сходимость по сетке (×2: $N=128\to256\to512$), отсутствие анизотропии; энергобаланс ≤1–3%.
Вариации: разные схемы дискретизации фракц. оператора.

**A1. Масштабирование и обезразмеривание**
Цель: проверить корректность безразмерной схемы.
Постановка: нормировки, единичные тесты, линейные эталоны.
Критерии: инвариантность профилей при смене базовых масштабов.

---

# Уровень B — фундаментальные свойства поля (слабозависимые)

**B1. Степенной хвост в однородной среде («космос»)**
Цель: подтвердить $A(r)\propto r^{\,2\beta-3}$ при $\lambda=0$.
Постановка: точечный дефект (ядро), однородные параметры; стац. задача.
Наблюдаемое/критерии: линейный тренд в $\log A$–$\log r$, R²≥0.99 на ≥1.5 декады; отсутствие узлов.
Вариации: $\beta\in[0.5,1.4]$, разные объёмы, разные ГУ (PML/большой тор).

**B2. Отсутствие сферических стоячих узлов**
Цель: показать, что в однородной «безинтервальной» среде узловые сферы не формируются.
Постановка: как B1.
Критерии: число смен знака $\partial_r A$ ≤ 1; отсутствие периодических нулей $A(r)$ при росте $r$.

**B3. Топологический заряд дефекта**
Цель: стабилизация «частицы»-ядра.
Постановка: численно интегрировать $\oint\nabla\phi\cdot dl$ вокруг ядра.
Критерии: $2\pi q$ с погрешностью ≤1%; устойчивость к гладким возмущениям.

**B4. Разделение зон (ядро/переход/хвост)**
Цель: количественно отделить три зоны.
Постановка: посчитать индикаторы $N,S,C$ (из прошлой заметки) и радиусы $r_\text{core}, r_\text{tail}$.
Критерии: пороги, напр. ядро $N>3, S>1$; хвост $N<0.3, S<0.3$.

---

# Уровень C — границы, ячейки, «последовательные резонаторы» (зависят от B)

**C1. Одна «стенка» (контраст адмиттансы)**
Цель: рождение ячейки/псевдорезонатора.
Постановка: сферическая оболочка с контрастом $\eta=\frac{|\Delta Y|}{\langle Y\rangle}$.
Наблюдаемое/критерии: пики $Y(\omega)$, локальные максимумы $A(r)$ между ядром и оболочкой; порог $\eta^\*$ для появления первой моды.

**C2. Цепочка резонаторов (ABCD)**
Цель: принцип последовательных резонаторов.
Постановка: 2–5 вложенных оболочек (разные $\eta,\,\Delta r$).
Критерии: согласование $Y_{\text{tot}}(\omega)$ с ABCD-моделью (ошибка мод менее 5% по $\omega_n$, 10% по $Q_n$); пассивность $\Re Y \ge 0$.

**C3. Квенч-память/пиннинг**
Цель: статичность огибающей относительно дефекта.
Постановка: добавить диссипативно-памятный член (ядро/оболочка).
Наблюдаемое/критерии: скорость дрейфа ячеек $v_{\text{cell}}$ по кросс-корреляции $I_{\rm eff}(t)$ → $<10^{-3}L/T_0$; подавление биений.

**C4. Биения двух близких мод**
Цель: различить дрейф/«заморозку» решётки.
Постановка: возбудить $\omega_1\approx\omega_2$, измерить $\Delta\omega,\Delta k$.
Критерии: $v_{\text{cell}}\approx \Delta\omega/|\Delta k|$ без пиннинга и $\to 0$ при пиннинге.

---

# Уровень D — многомодовое наложение и «поля» как огибающие (зависят от B–C)

**D1. Наложение мод на каркас**
Цель: стабильность «каркаса» при добавлении новых мод.
Постановка: последовательно добавлять возбуждения разных $\omega$.
Критерии: карта максимумов $I_{\rm eff}$ (Жаккар ≥0.8 до/после), пики $Y(\omega)$ сохраняют частоты в пределах 3–5%.

**D2. «ЭМ/сильное/слабое» как окна огибающих (прокси-тест)**
Цель: операциональная проверка проекции полей.
Постановка: три частотно-амплитудных окна:
— «EM»: слабонелинейная зона хвоста → проверка потоков $\propto\nabla\phi$;
— «сильное»: высоко-Q локальные моды у ядра;
— «слабое»: хиральные комбинации, малый Q/утечки.
Критерии: воспроизводимость характерных подписй (локализация/дальнодействие/анизотропия фазовых градиентов).

**D3. Пассивные спирали/линии потока**
Цель: сопоставить «вихревые» линии с $\nabla\phi$.
Постановка: трассировка линий уровня $\phi$ и поля $\nabla\phi$ вокруг дефекта.
Критерии: устойчивость поля направления, отсутствие материального транспорта (только фазовая геометрия).

---

# Уровень E — устойчивость и чувствительность (зависят от всего выше)

**E1. Чувствительность к параметрам**
Цель: устойчивость выводов.
Постановка: свип по $\beta,\ \kappa(\cdot),\ \chi'(\cdot),\ \chi''$, контрастам, размерам домена.
Критерии: неизменность качественных выводов; диапазоны, где меняется класс поведения (карта фаз).

**E2. Шум/неоднородности**
Цель: реалистичность.
Постановка: добавить слабую случайную неоднородность и шум источника.
Критерии: робастность показателей из B–D (отклонения ≤10–15%).

**E3. Финитно-размерные эффекты**
Цель: исключить влияние границ.
Постановка: масштаб домена ×2, ×3.
Критерии: инвариантность метрик (хвост, $Y(\omega)$, $r_\text{core}$) в пределах заявленной погрешности.

---

## Общие настройки и отчётность

* **Диапазоны параметров:** $\beta\in[0.5,1.4]$; контраст $\eta\in[0,0.5]$; память $\chi''$ от 0 до уровня «заморозки»; 1–5 оболочек.
* **Сетки:** $N^3=256^3$ базово, контроль $512^3$; радиальный 1D для сферических серий (ускорение ×50+).
* **Диагностика:** $A(r), \phi(r), \nabla A, \nabla\phi, Y(\omega), \{\omega_n,Q_n\}, v_{\text{cell}}$, индикаторы $N,S,C$, радиусы зон $r_\text{core},r_\text{tail}$.
* **Критерии пассивности:** $\Re Y(\omega)\ge0$, баланс мощности ≤3%.
* **Файнал:** таблица «эксперимент → выполнено/нет, метрики, графики», плюс сводная карта фаз по $(\eta,\chi'',\beta)$.

Если нужно — сразу дам шаблон конфигов для серий B1–C3 и CSV-структуру логов, чтобы вы могли прогнать пакетно и свести отчёт автоматически.

---

---
%%7d-31%%
---


Ниже — **строгое ТЗ для “Уровень A” (база)**. Оно самодостаточно: ИИ-исполнитель может писать код, не зная теории, опираясь только на этот документ.

---

# 0. Назначение

Проверить и зафиксировать корректность численного ядра для линейного безынтервального поля (БВП) в 3D с периодическими ГУ:

1. стационарная задача;
2. линейная во времени (квазистационарная) задача;
3. обезразмеривание/масштабная инвариантность.

Выход: набор автотестов с критериями приёмки, логами и артефактами (NPZ/HDF5), гарантирующими корректность решателя.

---

# 1. Математическая модель

## 1.1. Оператор и стационарная задача

Пусть $\Omega=[0,L)^3$, периодические ГУ. Поле $a(x)\in\mathbb{C}$.

**Оператор Рисса** (фракционный Лаплас):

$$
\mathcal{L}_\beta a \;\equiv\; \mu\,(-\Delta)^\beta a \;+\; \lambda\,a,\qquad \mu>0,\; \beta\in(0,2),\; \lambda\ge 0.
$$

**Стационарная задача:**

$$
\mathcal{L}_\beta a(x)\;=\; s(x),\quad x\in\Omega,\quad \text{периодич. ГУ.}
$$

**В частотной области** (дискрет. Фурье):

$$
\widehat{a}(k)\;=\;\frac{\widehat{s}(k)}{\mu\,|k|^{2\beta}+\lambda},\qquad k=\frac{2\pi}{L}\,m,\; m\in\mathbb{Z}^3.
$$

**Ноль-мода:** если $\lambda=0$, ЗАПРЕЩЕНО $\widehat{s}(0)\ne0$ (иначе сингулярность). Требование: $\widehat{s}(0)=0$ при $\lambda=0$.

## 1.2. Линейная во времени задача (для квазистационара)

$$
\partial_t a(x,t) + \nu\,(-\Delta)^\beta a(x,t) + \lambda\,a(x,t) \;=\; s(x,t),
$$

где $\nu>0$. В k-пространстве по модам:

$$
\partial_t \widehat{a}(k,t) + \alpha_k\,\widehat{a}(k,t)=\widehat{s}(k,t),\quad \alpha_k=\nu|k|^{2\beta}+\lambda.
$$

Аналитическое решение на шаге $[t_n,t_{n+1}]$ для $s=\widehat{s}_0 e^{-i\omega t}$ известно:

$$
\widehat{a}_{\mathrm{ss}}(k,t)=\frac{\widehat{s}_0 e^{-i\omega t}}{\alpha_k+i\omega}.
$$

Используется как эталон для тестов интегратора.

## 1.3. Энергетический функционал (стационар)

$$
\mathcal{E}[a]=\frac{1}{2}\Big(\mu\,\langle a,(-\Delta)^\beta a\rangle + \lambda\,\langle a,a\rangle\Big)-\Re\langle s,a\rangle.
$$

Решение минимизирует $\mathcal{E}$. Численно контролируем невязку $r=\mathcal{L}_\beta a-s$.

## 1.4. Обезразмеривание

Пусть масштабы: длина $L_0$, время $T_0$, амплитуда $A_0$. Вводим

$$
x=L_0 \tilde{x},\quad t=T_0 \tilde{t},\quad a=A_0 \tilde{a},\quad s=\frac{A_0}{T_0}\tilde{s}.
$$

Тогда

$$
\partial_{\tilde t} \tilde a + \underbrace{\nu\,T_0 L_0^{-2\beta}}_{\tilde\nu}(-\tilde\Delta)^\beta \tilde a + \underbrace{\lambda T_0}_{\tilde\lambda}\tilde a = \tilde s, 
$$

стац.: $\mu L_0^{-2\beta}\tilde{}\,(-\tilde\Delta)^\beta \tilde a + \lambda \tilde a = \tilde s$ с $\tilde s = s/A_0$.
**Требование инвариантности:** при корректной реализации перенормированные решения совпадают (см. тест A1).

---

# 2. Область, сетка, БПФ-соглашения

* Область: $\Omega=[0,L)^3$, $L>0$.
* Сетка: $N^3$, равномерная, $\Delta=L/N$.
* Координаты узлов: $x_i = i\Delta,\; i=0,\dots,N-1$ (аналогично по y,z).
* Дискретные векторы $m=(m_x,m_y,m_z)$, $m_j\in\{ -\lfloor N/2\rfloor,\dots,\lceil N/2\rceil-1\}$.
* Волновые числа: $k(m)=\frac{2\pi}{L}m$, $|k|=\sqrt{k_x^2+k_y^2+k_z^2}$.
* **Нормировка FFT** (зафиксировать одну!):

  * Прямое: $\widehat{a}(m)=\sum_{x} a(x)\,e^{-i k(m)\cdot x}\,\Delta^3$.
  * Обратное: $a(x)=\frac{1}{L^3}\sum_{m}\widehat{a}(m)\,e^{i k(m)\cdot x}$.
* Парсеваль: $\sum_x |a|^2 \Delta^3 = \frac{1}{L^3}\sum_m |\widehat a|^2$.

---

# 3. Алгоритмы (минимум, что обязан уметь код)

## 3.1. Стационарный решатель (спектральный, прямой)

1. Вычислить $\widehat{s}(m)$ БПФ.
2. Для всех $m$: деноминатор $D(m)=\mu |k(m)|^{2\beta}+\lambda$.
3. Проверки:

   * Если $\lambda=0$, то **обязательно** $\widehat{s}(0)=0$ (иначе FAIL).
   * Если $\lambda>0$, то $D(0)=\lambda$.
4. $\widehat{a}(m)=\widehat{s}(m)/D(m)$.
5. Обратная БПФ → $a(x)$.
6. Резерв: вычислить невязку $r(x)=\mu(-\Delta)^\beta a + \lambda a - s$ через FFT (умножая $\widehat a$ на $|k|^{2\beta}$).

## 3.2. Временной решатель (линейный)

Рекомендуется **точный экспоненциальный интегратор** по модам:

$$
\widehat{a}^{n+1}(k) = e^{-\alpha_k \Delta t}\widehat{a}^n(k) + \int_0^{\Delta t} e^{-\alpha_k(\Delta t-\tau)}\widehat{s}(k,t_n+\tau)\,d\tau.
$$

Для $s(k,t)=\widehat{s}_0 e^{-i\omega t}$:

$$
\widehat{a}^{n+1}=e^{-\alpha_k\Delta t}\widehat{a}^n + \widehat{s}_0 e^{-i\omega t_{n+1}}\frac{1-e^{-(\alpha_k-i\omega)\Delta t}}{\alpha_k-i\omega}.
$$

Альтернатива: неявная схема Кранка–Николсон (CN), аппрокс. 2-го порядка:

$$
\frac{\widehat a^{n+1}-\widehat a^n}{\Delta t} + \alpha_k\frac{\widehat a^{n+1}+\widehat a^n}{2} = \widehat s\Big(k, t_n+\tfrac{\Delta t}{2}\Big).
$$

CN безусловно устойчива для линейного члена.

---

# 4. Наборы тестов “Уровень A”

(**Все тесты обязательны**, оформляются как юнит-тесты; каждый создаёт отчёт JSON + артефакты.)

## A0. Базовая валидация решателей

### A0.1. Плоская волна (стационар)

**Цель:** проверить формулу $\widehat a = \widehat s / D$.

* Конфиг: $L=1$, $N\in\{64,128,256\}$, $\mu=1$, $\beta\in\{0.5,1.0,1.5\}$, $\lambda\in\{0, 1\}$.
* Источник: $s(x)=e^{i k^\*\cdot x}$ с $k^\*=\frac{2\pi}{L}(p,q,r)$, выбираем набор $(p,q,r)$ с одинаковой $|k^\*|$, но разными направлениями (напр. $(4,0,0),(0,4,0),(3,3,2)$).
* Аналитика: $\widehat s$ ненулева только в $m^\*$; $a(x)=s(x)/D(m^\*)$.
* Метрики:

  * Ошибка в $L^2$: $E_2 = \|a_\text{num}-a_\text{ref}\|_2 / \|a_\text{ref}\|_2 \le 10^{-12}$.
  * Анизотропия: для всех направлений с одинаковым $|k^\*|$ амплитуды совпадают: $\max$ относит. откл. $\le 10^{-12}$.

### A0.2. Периодический многочастотный источник (стационар)

**Цель:** проверить суперпозицию и отсутствие алиасинга.

* $s(x)=\sum_{j=1}^J c_j e^{i k_j\cdot x}$, $J=10$, случайные целочисл. $k_j$ в пределах Найквиста (без пересечений по модам), $c_j\in\mathbb{C}$.
* Аналитика: $\widehat a(k_j)=c_j/D(k_j)$, остальное — нули.
* Метрики: как в A0.1 (порог $10^{-12}$).

### A0.3. Случай “$\lambda=0$” и нулевая мода

**Цель:** корректная обработка $\widehat s(0)$.

* Два прогона:

  1. $\lambda=0$, $\widehat s(0)=0$ (константа в источнике удалена) — ОЖИДАЕТСЯ нормальная работа.
  2. $\lambda=0$, $\widehat s(0)\ne0$ — ОЖИДАЕТСЯ отказ (исключение) с ясным сообщением: *“lambda=0 требует mean(s)=0”*.
* Приёмка: обнаружение условия, корректные коды возврата/ошибки.

### A0.4. Временной решатель: плоская волна, гармонический источник

**Цель:** проверить интегратор.

* Задача: $\partial_t a + \nu(-\Delta)^\beta a + \lambda a = s_0 e^{i k^\*\cdot x} e^{-i\omega t}$.
* Параметры: $\nu=1$, $\beta\in\{0.5,1.0\}$, $\lambda\in\{0,0.1\}$, $\omega\in\{1,10\}$.
* Аналитика по моде $k^\*$: в установившемся режиме

  $$
  a_{\mathrm{ss}}(x,t)=\frac{s_0}{\nu|k^\*|^{2\beta}+\lambda+i\omega} e^{i k^\*\cdot x}e^{-i\omega t}.
  $$
* Алгоритм: запустить до $t_{\text{ss}}=10/(\nu|k^\*|^{2\beta}+\lambda)$, сравнить амплитуду и фазу со значением выше.
* Метрики: относит. ошибка амплитуды и фазы $\le 10^{-8}$ (CN или экспоненциальный шаг).

### A0.5. Энергетический баланс/невязка (стац.)

**Цель:** подтвердить решение как минимум функционала и уравнения.

* Рассчитать невязку $r=\mathcal{L}_\beta a - s$ (через FFT).
* Критерии:

  * $\|r\|_2 / \|s\|_2 \le 10^{-12}$ (двойная точность, прямой спектральный решатель).
  * $\Re\sum_m \overline{\widehat a(m)}\,\widehat r(m) \approx 0$ (ортогональность невязки к решению; допуск $\le 10^{-12}\|\widehat a\|_2\|\widehat r\|_2$).

## A1. Обезразмеривание/инвариантность

### A1.1. Инвариантность к масштабу длины

**Цель:** проверить корректный пересчёт при смене $L$.

* Два прогона: (i) $L=1,N=256$; (ii) $L=2,N=512$ (тот же $\Delta$). Один и тот же безразмерный источник $\tilde s$ (т.е. физически $s$ масштабирован).
* Требование: безразмерные решения $\tilde a$ совпадают по норме:
  $\|\tilde a^{(1)}-\tilde a^{(2)}\|_2/\|\tilde a^{(1)}\|_2 \le 10^{-12}$.

### A1.2. Инвариантность к выбору базовых единиц $(L_0,T_0,A_0)$

**Цель:** проверить 1.4.

* Два прогона с разными $(L_0,T_0,A_0)$, но одинаковыми $(\tilde\nu,\tilde\lambda,\tilde s)$.
* Критерий: совпадение $\tilde a$ в допуске $10^{-12}$.

---

# 5. Требования к реализации

* Язык: Python 3.10+ (или C++/Rust с эквивалентной точностью), **float64**.
* Библиотеки: NumPy/SciPy/FFTW или эквивалент с планом “MEASURE”.
* Параллелизация: опционально (не влияет на числовые критерии).
* **Единые соглашения FFT** (см. §2). Любая иная нормировка — ЗАПРЕЩЕНА.
* Обработка индексов k: отрицательные частоты через смещение $[-N/2, N/2)$.
* Проверка входных данных: выброс понятных исключений при $\lambda=0,\ \widehat s(0)\ne0$.

---

# 6. Интерфейс конфигурации (JSON/YAML)

Минимальный набор ключей:

```json
{
  "domain": {"L": 1.0, "N": 256},
  "physics": {"mu": 1.0, "beta": 1.0, "lambda": 0.0, "nu": 1.0},
  "time": {"dt": 1e-3, "T": 1.0, "scheme": "exp" },
  "forcing": {
    "type": "plane_wave", 
    "modes": [[4,0,0]], 
    "amplitudes": [[1.0, 0.0]],
    "omega": 0.0
  },
  "output": {"dir": "out", "save_fields": true, "save_spectra": true, "precision": "float64"},
  "tests": ["A0.1","A0.2","A0.3","A0.4","A0.5","A1.1","A1.2"],
  "seed": 42
}
```

Разрешённые `forcing.type`: `plane_wave`, `multi_plane`, `harmonic_in_time`, `random_shell` (для анизотропии).
Все параметры должны сериализоваться в отчёт.

---

# 7. Выходные данные и отчётность

1. **Поля/спектры**: `a_realspace.npy`, `a_kspace.npy`, `s_kspace.npy`.
2. **Диагностика**: `residual_k.npy`, `residual_norms.json`.
3. **Метрики** (JSON): ошибки $E_2,E_\infty$, анизотропия, невязка, успешность тестов.
4. **Логи** (CSV): строка на тест с параметрами и verdict ∈ {PASS, FAIL}.
5. **Повторяемость**: записать версии библиотек и ОС.

---

# 8. Критерии приёмки (сводно)

* A0.1–A0.2: $E_2 \le 10^{-12}$, анизотропия ≤ $10^{-12}$.
* A0.3: корректный FAIL/сообщение при нарушении $\widehat s(0)=0$ при $\lambda=0$.
* A0.4: ошибка амплитуды и фазы ≤ $10^{-8}$.
* A0.5: $\|r\|_2/\|s\|_2 \le 10^{-12}$, ортогональность — в допуске.
* A1.1–A1.2: инвариантность ≤ $10^{-12}$.

**Все** тесты должны проходить. Любое отклонение — FAIL с отчётом.

---

# 9. Численные предосторожности

* Нормировка FFT должна строго соответствовать §2.
* Проверять переполнение при вычислении $|k|^{2\beta}$ (использовать `float64`).
* Для $k=0$: использовать $D(0)=\lambda$ (если $\lambda>0$).
* Для временного интегратора: при явных схемах dt ограничен как $\Delta t \le c / (\nu k_{\max}^{2\beta}+\lambda)$; рекомендуется экспоненциальный шаг или CN.

---

# 10. Структура репозитория

```
/core
  fft_solver.py
  frac_laplacian.py
  time_integrators.py
/tests
  test_A01_plane_wave.py
  test_A02_multi_plane.py
  test_A03_zero_mode.py
  test_A04_time_harmonic.py
  test_A05_residual_energy.py
  test_A11_scale_length.py
  test_A12_units_invariance.py
/configs
  *.json
/out
  <автоматически создаётся>
```

---

# 11. Итог

Выполнение “Уровень A” подтверждается автоматическим отчётом, где **все** тесты A0.1–A0.5, A1.1–A1.2 имеют статус **PASS** и укладываются в численные допуски, заданные в §8.



---


---
%%7d-32%%
---


**“Уровень B — фундаментальные свойства поля (слабозависимые)”**. 

---

# 0. Назначение

Подтвердить численно базовые свойства безынтервального поля (БВП) в однородной среде с периодическими ГУ:

* **B1. Степенной хвост** решения точечного возбуждения и оценка показателя спада.
* **B2. Отсутствие сферических стоячих узлов** в однородном случае.
* **B3. Топологический заряд (обмотка фазы)** — корректность вычисления и устойчивость оценки.
* **B4. Количественное разделение зон** «ядро—переход—хвост» по объективным метрикам.

Выход: автотесты с критериями приёмки, журналы расчётов, графики и файлы артефактов.

---

# 1. Математическая модель и допущения

## 1.1. Область, ГУ, оператор

* Область: $\Omega=[0,L)^3$, периодические ГУ.
* Поле: $a(x)\in\mathbb C$.
* Оператор Рисса (стационар):

  $$
  \mathcal L_\beta a \;=\; \mu\,(-\Delta)^\beta a \;+\; \lambda\,a,\qquad \mu>0,\ \beta\in(0,2),\ \lambda\ge0.
  $$
* Стационарная задача: $\mathcal L_\beta a=s(x)$.

## 1.2. Спектральная форма

* Дискретные волновые числа: $k=\tfrac{2\pi}{L}m,\ m\in\mathbb Z^3$.
* В k-области: $\widehat a(k)=\widehat s(k)/(\mu|k|^{2\beta}+\lambda)$.
* При $\lambda=0$ обязательно $\widehat s(0)=0$.

## 1.3. Источник «квази-точечный»

Для имитации точечного возбуждения применить **нейтрализованную гауссиану**:

$$
g_\sigma(x)=\exp\!\Big(-\tfrac{|x-x_0|^2}{2\sigma^2}\Big),\quad
\bar g=\tfrac{1}{L^3}\!\int_\Omega g_\sigma\,dx,\quad
s(x)=g_\sigma(x)-\bar g.
$$

* $\sigma\in[1.5\Delta,\,3\Delta]$ (чтобы избежать одиночного узла сетки).
* Центр $x_0=(L/2,L/2,L/2)$.
* Тогда $\widehat s(0)=0$ автоматически.

---

# 2. Сетка, FFT и нормы (как в “Уровень A”)

* Сетка: $N^3$ узлов, $\Delta=L/N$. Ряды индексов: $[-N/2,\dots,N/2-1]$ по всем осям.
* Нормировки FFT — строго те же, что зафиксированы на “Уровень A”.
* Все расчёты — **float64**.

---

# 3. Диагностика и метрики

## 3.1. Радиальное усреднение

* Радиус $r=|x-x_0|$.
* Биннинг: равномерные бины $r_j\in[j\Delta,(j+1)\Delta)$, $j=0,\dots,\lfloor L\sqrt3/(2\Delta)\rfloor$.
* Радиальный профиль амплитуды:

  $$
  A(r_j)=\text{mean}\big(|a(x)|:\ r\in[r_j,r_{j+1})\big).
  $$
* Радиус анализа: $r\in[r_{\min},\,r_{\max}]$, где
  $r_{\min}=4\Delta$ (вне ядра сглаживания),
  $r_{\max}=\min(L/4,\ r\ \text{где}\ A(r)<10^{-12}\,A(r_{\min}))$.

## 3.2. Лог-лог регрессия

Для **B1**: линейная регрессия $y=\alpha+p\,x$ на $x=\log r,\ y=\log A$.

* Оценки: наклон $\hat p$, $R^2$, доверительный интервал (ДИ) для $\hat p$.

## 3.3. Однотонность и «узлы»

Для **B2**: сглаженный производный признак:

* Сгладить $A(r_j)$ фильтром Савицкого–Голея (окно ≥ 9 бинов, полином 3).
* Численно дифференцировать → $A'(r_j)$.
* Подсчитать число **изменений знака** $A'(r_j)$ на диапазоне $[r_{\min},r_{\max}]$.

## 3.4. Топологический заряд (2D-сечение)

Для **B3** вычисляется обмотка фазы на плоском срезе $z=z_0$ (или в 2D-тесте):

* Фаза $\phi(x,y)=\operatorname{atan2}(\Im a,\Re a)$ на сетке.
* Замкнутый контур $C$: дискретная окружность радиуса $\rho$ вокруг центра $(x_0,y_0)$.
* Оценка обмотки:

  $$
  \hat q(\rho)=\frac{1}{2\pi}\sum_{n}\operatorname{unwrap}\big(\phi_{n+1}-\phi_n\big),
  $$

  где $\operatorname{unwrap}$ переводит скачки $\pm\pi$ в непрерывную сумму.
* Возьмите несколько $\rho$ (например, $6\Delta,8\Delta,10\Delta$); усредните: $\bar q$.

## 3.5. Индикаторы зон (ядро/переход/хвост)

Пусть $A(r)$ — профиль; в линейной постановке используем геометрические индикаторы:

$$
S(r)=\frac{|dA/dr|}{k_\text{ref} A},\qquad
C(r)=\frac{|d^2A/dr^2|}{k_\text{ref}^2 A}.
$$

* **Опорная шкала** $k_\text{ref}=2\pi/\xi$, где $\xi$ — оценка радиуса ядра (см. ниже).
* Радиусы:

  * $r_\text{core}$: наименьший $r$, где $S(r)\le1\ \&\ C(r)\le1$.
  * $r_\text{tail}$: наименьший $r>r_\text{core}$, где $S(r)\le0.3\ \&\ C(r)\le0.3$.
* Оценка $\xi$: вторым моментом $ \xi^2 = \dfrac{\sum r^2 A(r)}{\sum A(r)}$ по $r\le L/8$.

---

# 4. Алгоритмы и процедуры

## 4.1. Стационарный решатель (спектральный, прямой)

1. Построить $s(x)=g_\sigma(x)-\bar g$.
2. FFT $\to \widehat s(k)$.
3. Для всех $k$: $D(k)=\mu|k|^{2\beta}+\lambda$.
4. $\widehat a(k)=\widehat s(k)/D(k)$.
5. iFFT $\to a(x)$.
6. Вычислить невязку $r(x)=\mu(-\Delta)^\beta a+\lambda a - s$ (через умножение $\widehat a$ на $|k|^{2\beta}$).

## 4.2. Формирование синтетической «фазовой обмотки» (для B3)

Два режима (оба обязательны):

* **B3-S (Synthetic/аналитический тест 2D):**
  На $[0,L)^2$ задать сетку $N^2$. Построить поле

  $$
  a_\text{syn}(x,y)=f(\rho)\,e^{i q\,\arg(x-x_0+i(y-y_0))},\quad f(\rho)=\sqrt{\frac{\rho^2}{\rho^2+\xi^2}},
  $$

  где $\rho$ — расстояние до центра, $q\in\{\pm1,\pm2\}$. Затем применить процедуру оценки $\hat q$ на контурах $C$.

* **B3-P (PDE-возбуждение, 3D срез):**
  Возбудить стационарную задачу **комплексным** источником вида
  $s(x)=g_\sigma(x)\,e^{i q\theta(x)}-\bar s$, где $\theta$ — азимутальный угол в плоскости $(x,y)$.
  Решить на $[0,L)^3$. На срезе $z=L/2$ вычислить $\bar q$ как в 3.4.

Примечание: $\bar s$ обеспечивает нулевую моду при $\lambda=0$.

## 4.3. Радиальный анализ

* Вычислить $A(r)$, далее — сглаживание, производные (S-G), показатели $S(r),C(r)$, границы зон, лог-лог регрессию.

---

# 5. Наборы тестов “Уровень B”

(**Все тесты обязательны**, каждый — отдельный юнит-тест, генерирует JSON-отчёт + артефакты.)

## B1. Степенной хвост (космос)

**Цель:** подтвердить $A(r)\propto r^{\,2\beta-3}$ (без узлов) для $\lambda=0$.

* Параметры: $\mu=1$; $\beta\in\{0.6,0.8,1.0,1.2,1.4\}$; $\lambda=0$.
* Геометрия: $L=8\pi$; сетки $N\in\{256,384,512\}$ (сходимость). $\sigma=2\Delta$.
* Процедура: решить стац.; получить $A(r)$; выполнить лог-лог регрессию на $[r_{\min},r_{\max}]$ (см. §3.1).
* **Критерии приёмки:**

  * Наклон $\hat p$ в ДИ 95% попадает в $p_\text{теор}=2\beta-3 \pm 0.05$.
  * $R^2\ge 0.99$ на диапазоне не менее **1.5 декады** по $r$.
  * Сходимость по сетке: $|\hat p_{N_2}-\hat p_{N_1}|\le 0.02$ при $N_2/N_1\ge 1.5$.
  * Невязка: $\|r\|_2/\|s\|_2\le 10^{-11}$.

**Доп.проверка (k-space):** линейная регрессия $\log|\widehat a(k)|$ vs $\log|k|$ для сферических слоёв в диапазоне $[2k_0,\,k_\text{Ny}/3]$; ожидаемый наклон $-2\beta\pm0.05$.

---

## B2. Отсутствие сферических стоячих узлов

**Цель:** показать монотонность $A(r)$ (без периодических нулей).

* Параметры: как в B1 (взять хотя бы 3 значения $\beta$).
* Процедура: сгладить $A(r)$ (S-G), получить $A'(r)$, посчитать число изменений знака на $[r_{\min},r_{\max}]$.
* **Критерии приёмки:**

  * Число изменений знака $Z\le 1$ (разрешён единичный локальный перегиб на границе ядра);
  * Не выявлены регулярные узловые сферы (циклические нули) — формально: число локальных максимумов-минимумов $M\le 2$ на всём диапазоне.
  * $\min_r A(r)>0$ на $[r_{\min},r_{\max}]$ в пределах числ. шума (порог $10^{-14}\max A$).

---

## B3. Топологический заряд (обмотка)

**Цель:** проверить корректность вычисления обмотки фазы и устойчивость оценки к дискретизации.

**B3-S (2D синтетика):**

* Область: $[0,L)^2$, $L=2\pi$, $N\in\{256,512,1024\}$.
* Поле: $a_\text{syn}(x,y)$ как в §4.2 (S). Параметры: $q\in\{\pm1,\pm2\}$, $\xi=3\Delta$.
* Для $\rho\in\{6\Delta,8\Delta,10\Delta\}$ вычислить $\hat q(\rho)$, затем $\bar q$.
* **Критерии приёмки:** $|\bar q-q|\le 0.01$ для всех $q$ и $N$; дисперсия оценок по $\rho$ $\le 0.01$.

**B3-P (3D PDE + срез):**

* Область: $[0,L)^3$, $L=4\pi$, $N\in\{256,384\}$.
* Источник: $s(x)=g_\sigma(x)\,e^{iq\theta(x)}-\bar s$, $\sigma=2\Delta$, $q\in\{\pm1\}$.
* Решить стац.; на срезе $z=L/2$ измерить $\bar q$ как в B3-S.
* **Критерии приёмки:** $|\bar q-q|\le 0.05$; стабильность по сетке: $|\bar q_{N_2}-\bar q_{N_1}|\le 0.02$.

---

## B4. Разделение зон ядро/переход/хвост

**Цель:** объективно выделить границы зон и проверить их сходимость/согласованность с хвостом.

* Параметры: выбрать один кейс из B1 (напр., $\beta=1.0$, $L=8\pi$, $N\in\{256,512\}$, $\sigma=2\Delta$).

* Процедура:

  1. Вычислить $A(r)$, оценить $\xi$ (§3.5).
  2. Посчитать $S(r),C(r)$ (разностные формулы 2-го порядка на сглаженном $A$).
  3. Найти $r_\text{core}$ и $r_\text{tail}$ по порогам (§3.5).
  4. Проверить, что линейная регрессия на $[r_\text{tail},r_{\max}]$ даёт наклон $\hat p$ в допустимых границах B1.

* **Критерии приёмки:**

  * Сходимость: $|r_\text{core}(N_2)-r_\text{core}(N_1)|/r_\text{core}(N_1)\le 5\%$; аналогично для $r_\text{tail}$.
  * Упорядочение: $0<r_\text{core}<r_\text{tail}<L/4$.
  * Согласованность хвоста: $|\hat p-(2\beta-3)|\le 0.05$ на $[r_\text{tail},r_{\max}]$.

---

# 6. Диапазоны параметров и конфиги

## 6.1. Общие значения

* $\mu=1$; $\lambda=0$ (если не указано иначе).
* $\beta$ по тесту (см. выше).
* $L$ и $N$ — по тесту.
* $\sigma=2\Delta$ (если не указано иначе).
* Псевдослучайные числа — `seed=42`.

## 6.2. Пример конфигураций (JSON)

### B1 (один прогон)

```json
{
  "case": "B1_power_law_tail",
  "domain": {"L": 25.1327412287, "N": 384},
  "physics": {"mu": 1.0, "beta": 1.2, "lambda": 0.0},
  "source": {"type": "gaussian_neutralized", "sigma_in_cells": 2.0, "center": "auto"},
  "analysis": {
    "radial": {"rmin_cells": 4, "rmax_fraction_of_L": 0.25},
    "fit": {"min_decades": 1.5}
  },
  "output": {"dir": "out/B1_beta12", "save_profiles": true, "save_spectra": true}
}
```

### B3-S (2D синтетика)

```json
{
  "case": "B3S_winding_synthetic_2D",
  "domain2d": {"L": 6.28318530718, "N": 512},
  "synthetic_field": {"q": 2, "xi_in_cells": 3, "center": "auto"},
  "analysis": {"radii_cells": [6, 8, 10]},
  "output": {"dir": "out/B3S_q2"}
}
```

### B3-P (3D, PDE + срез)

```json
{
  "case": "B3P_winding_PDE_3D",
  "domain": {"L": 12.56637061436, "N": 384},
  "physics": {"mu": 1.0, "beta": 1.0, "lambda": 0.0},
  "source": {"type": "gaussian_azimuthal_neutralized", "q": -1, "sigma_in_cells": 2.0},
  "slice": {"z_index": "mid"},
  "analysis": {"radii_cells": [6, 8, 10]},
  "output": {"dir": "out/B3P_qm1", "save_fields": true}
}
```

### B4 (зоны)

```json
{
  "case": "B4_zones_core_transition_tail",
  "domain": {"L": 25.1327412287, "N": 512},
  "physics": {"mu": 1.0, "beta": 1.0, "lambda": 0.0},
  "source": {"type": "gaussian_neutralized", "sigma_in_cells": 2.0},
  "zone_metrics": {"S_tail": 0.3, "C_tail": 0.3, "S_core": 1.0, "C_core": 1.0},
  "output": {"dir": "out/B4_beta10", "save_profiles": true}
}
```

---

# 7. Выходные данные и отчётность

* **Поля/спектры:** `a_realspace.npy`, `a_kspace.npy`, `s_realspace.npy`, `s_kspace.npy`.
* **Радиальные профили:** `radial_profile.csv` (колонки: `r, A, A_smooth, dA_dr, d2A_dr2, S, C`).
* **k-анализ:** `shell_spectrum.csv` (колонки: `k_shell, |a|_mean`).
* **Метрики/итоги:** JSON `metrics.json` (детально по каждому критерию).
* **Графики (png/pdf):** `A_vs_r_loglog.*`, `A_prime_vs_r.*`, `spectrum_loglog.*`, `zones_marked.*`.
* **Логи:** CSV `runs.csv` (параметры, хэши входных файлов, вердикт).
* **Повторяемость:** `env.txt` (версии библиотек/ОС/FFT-план).

---

# 8. Критерии приёмки (сводно)

* **B1:** $|\hat p-(2\beta-3)|\le 0.05$, $R^2\ge 0.99$, минимум 1.5 декады по $r$; k-склон $-2\beta\pm0.05$.
* **B2:** $Z\le 1$, $M\le 2$, $\min_r A(r)>10^{-14}\max A$.
* **B3-S:** $|\bar q-q|\le 0.01$ для каждого $q\in\{\pm1,\pm2\}$, стабильность по $N$.
* **B3-P:** $|\bar q-q|\le 0.05$, стабильность по сетке $\le 0.02$.
* **B4:** сходимость $r_\text{core}, r_\text{tail}$ (≤5%), упорядочение зон, согласованность хвоста с B1.

Все критерии должны быть выполнены. Любое нарушение — **FAIL** с развёрнутым отчётом.

---

# 9. Численные предосторожности

1. **Образы источника:** при $\lambda=0$ используйте только нейтрализованный источник (см. §1.3).
2. **Границы анализа:** не использовать данные при $r<4\Delta$ и $r>L/4$.
3. **Сглаживание:** S-G фильтр применять только для производных; для регрессии использовать **несглаженный** $A(r)$.
4. **Устойчивость оценок:** регрессию выполнять с выбросоустойчивой метрикой (Huber) + обычная OLS для отчёта; проверка на мультиколлинеарность не требуется.
5. **k-область:** игнорировать $k=0$; регрессию вести в диапазоне $[2k_0,\,k_\text{Ny}/3]$.
6. **Память и производительность:** 3D $384^3$ \~ несколько ГБ RAM; сохранять только нужные массивы (см. §7).

---

# 10. Структура репозитория

```
/core
  solver_stationary.py
  frac_operator_fft.py
  radial_analysis.py
  winding_estimator.py
  spectra_shells.py
/tests
  test_B1_power_law.py
  test_B2_no_nodes.py
  test_B3S_winding_synthetic_2D.py
  test_B3P_winding_PDE_3D.py
  test_B4_zones.py
/configs
  B1_*.json
  B3S_*.json
  B3P_*.json
  B4_*.json
/out
  <автоматически>
```

---

# 11. Итог

“Уровень B” считается выполненным, когда все тесты B1–B4 имеют статус **PASS** с допусками из §8, отчёты и артефакты сформированы согласно §7, а коды отказов/сообщения об ошибках корректно обрабатываются по правилам §9.


----


---
%%7d-33%%
---


**“Уровень C — границы, ячейки, последовательные резонаторы и пиннинг”**

---

# 0. Назначение

Численно подтвердить и количественно описать эффекты, возникающие при наличии **контраста/границ** в безынтервальном поле (БВП):

* **C1. Одиночная «стенка» (контраст/потери) → рождение ячейки/резонанса**.
* **C2. Цепочка резонаторов (несколько оболочек) и согласование с ABCD-моделью**.
* **C3. Память/пиннинг (quench-like)** → подавление дрейфа огибающей.
* **C4. Биения двух близких мод** → измерение скорости дрейфа решётки и её подавление пиннингом.

Выход: автотесты, отчёты, графики, файлы артефактов, параметры найденных мод $\{\omega_n,Q_n\}$, карты полей и метрики.

---

# 1. Математическая постановка

## 1.1. Область, ГУ, сетка

* Область: $\Omega=[0,L)^3$, **периодические** ГУ.
* Рекомендованные базовые размеры для 3D: $L\in[24\pi, 48\pi]$, сетки $N\in\{256,384,512\}$.
* Все расчёты — **float64**. FFT-нормировки и индексация **строго** как в “Уровень A”.

## 1.2. Базовый оператор и временная модель

Поле $a(x,t)\in\mathbb C$. Базовое уравнение:

$$
\partial_t a + \nu(-\Delta)^\beta a + \lambda\,a \;+\; \sum_{j=1}^{J}\gamma_j(x)\,m_j \;=\; s(x,t),\qquad \nu>0,\ \beta\in(0,2),\ \lambda\ge0,
$$

где $m_j$ — **мемориальные (пиннинговые) переменные** с локальной динамикой Дебая:

$$
\tau_j(x)\,\partial_t m_j + m_j = a.
$$

* Без памяти: берём $J=0$ (или $\gamma_j\equiv0$).
* С памятью: $J\ge1$; $\gamma_j,\tau_j$ заданы **по слоям** (см. §2).

### Частотная форма (гармонический режим)

При $s(x,t)=\hat s(x,\omega)e^{-i\omega t}$ стационарная по времени амплитуда $\hat a(x,\omega)$ удовлетворяет:

$$
\Big(\nu(-\Delta)^\beta + \lambda + i\omega + \underbrace{\sum_j \frac{\gamma_j(x)}{\,1+i\omega\tau_j(x)\,}}_{\displaystyle \Gamma_{\rm mem}(x,\omega)}\Big)\,\hat a(x,\omega)=\hat s(x,\omega).
$$

**Пассивность:** $\Re\,\Gamma_{\rm mem}=\sum_j \gamma_j/(1+\omega^2\tau_j^2)\ge0$.

---

# 2. Геометрия, маски и параметры слоёв

## 2.1. Сферические слои (оболочки)

* Центр: $x_0=(L/2,L/2,L/2)$.
* Радиус $r=|x-x_0|$.
* **Слой $\ell$**: маска $M_\ell(x)=1$ для $r\in[R_\ell, R_\ell+\Delta R_\ell]$, иначе 0.
* Рекомендовано: $\Delta R_\ell\in[2\Delta,4\Delta]$ (тонкая стенка).
* Внутренний «референс-шар»: $\mathcal R_{\rm ref}=\{r\le R_{\rm ref}\}$, $R_{\rm ref}\in[3\Delta,5\Delta]$.

## 2.2. Параметры по областям

В каждой области (фон/слои) задаются константы:

$$
\nu(x),\ \lambda(x),\ \{\gamma_j(x),\tau_j(x)\}_{j=1..J}.
$$

Чаще всего $\nu,\lambda$ одинаковы, а контраст создаётся $\gamma,\tau$ только в слоях.

## 2.3. Контраст (для C1/C2)

Вводим безразмерный **контраст по «адмиттансе»** слоя $\ell$ на опорной частоте $\omega_{\rm ref}$:

$$
\eta_\ell=\frac{\Re\,\Gamma_{\rm mem}^{(\ell)}(\omega_{\rm ref})}{\nu k_{\rm ref}^{2\beta}+\lambda},\qquad k_{\rm ref}=\frac{\pi}{R_\ell+\Delta R_\ell/2}.
$$

Типичные свипы: $\eta_\ell\in[0,0.5]$ при $\omega_{\rm ref}\in[0.5,2.0]$ (безразм.).

---

# 3. Источники и режимы расчёта

## 3.1. Источник для «точечного» возбуждения

**Нейтрализованная гауссиана** (как в B-уровне):

$$
g_\sigma(x)=\exp\!\Big(-\frac{|x-x_0|^2}{2\sigma^2}\Big),\quad s(x)=g_\sigma(x)-\bar g,\quad \sigma=2\Delta.
$$

## 3.2. Гармонический свип по частоте (C1, C2)

* Диапазон: $\omega\in[\omega_{\min},\omega_{\max}]$, напр. $[0.05,5.0]$.
* Шаг: **логарифмический** (≥ 60 точек/декада) + локальное уточнение вокруг пиков (до 1–2‰ по $\omega$).
* На каждой $\omega$: решается стац. частотная задача, далее пост-процессинг (§4).

## 3.3. Временные расчёты (C3, C4)

* Схема: экспоненциальный интегратор по модам **или** CN; для $m_j$ — неявно/аналитически.
* **Биения (C4):** источник $s(x,t)=\sum_{q=1}^2 s_q(x)\,e^{-i\omega_q t}$ с $|\omega_2-\omega_1|=\Delta\omega\ll\omega_{1,2}$; $s_1=s_2=g_\sigma-\bar g$.
* Окно усреднения огибающей: $\Delta t_{\rm avg}$ с $\omega_{1,2}^{-1}\ll\Delta t_{\rm avg}\ll (\Delta\omega)^{-1}$.

---

# 4. Наблюдаемые величины, «адмиттанса» и метрики

## 4.1. Усреднения по слоям/сечениям

* В каждой тонкой сфере $S(R)=\{r=R\}$ и в каждом слое $\ell$ вычислять:

  * **Средняя амплитуда**: $U(R,\omega)=\langle \hat a\rangle_{S(R)}$.
  * **Радиальный профиль**: $A(r,\omega)$ (сферическое усреднение как в B-уровне).
  * **Градиенты**: $A_r=\partial_r A$ по разностям (сглаживание S-G, окно ≥9).

## 4.2. Мощность/пассивность

Для любой области $V\subset\Omega$ и частоты $\omega$ определить «диссипативную мощность»:

$$
P_V(\omega)=\!\int_V\!\Big[\,\nu\big|(-\Delta)^{\beta/2}\hat a\big|^2+\lambda\,|\hat a|^2+\Re\,\Gamma_{\rm mem}(x,\omega)\,|\hat a|^2\Big]\,dV\ \ge 0.
$$

* **Проверка пассивности:** $P_\Omega(\omega)\ge 0$ для всех $\omega$.

## 4.3. Эффективная «портовая адмиттанса»

Выбираем **референс-амплитуду** $U_{\rm ref}(\omega)=\langle \hat a\rangle_{\mathcal R_{\rm ref}}$, $\mathcal R_{\rm ref}\subset\Omega$ — шар у центра.
Для слоя $\ell$:

$$
Y_\ell(\omega)=\frac{P_{V_\ell}(\omega)}{|U_{\rm ref}(\omega)|^2},\qquad V_\ell=\{R_\ell\le r\le R_\ell+\Delta R_\ell\}.
$$

**Интерпретация:** пики $Y_\ell(\omega)$ соответствуют частотам усиленной «закачки» энергии в слой (эффект резонатора/ячейки).

## 4.4. Идентификация мод и Q-факторов

* Пики $Y(\omega)$ искать по проминенсу ≥ $p_{\min}$ над локальным фоном (по умолчанию 8 дБ).
* Частота пика $\omega_n$ — максимум $Y$ в окрестности.
* **Полоса полувсплеска**: $[\,\omega_{n-},\omega_{n+}\,]$ на уровне $Y(\omega_n)/\sqrt2$.
* **Качество:** $Q_n=\omega_n/(\omega_{n+}-\omega_{n-})$.

---

# 5. Метод ABCD (двухпорт) для слоёв (C2)

## 5.1. Сферически-радиальная редукция состояния

Для заданного $\omega$ определим **состояние на сфере** $r=R$:

$$
\mathbf v(R,\omega)=
\begin{bmatrix}
A(R,\omega)\\[2pt]
A_r(R,\omega)
\end{bmatrix}.
$$

Для слоя $\ell$ со входом $R_{\rm in}=R_\ell$ и выходом $R_{\rm out}=R_\ell+\Delta R_\ell$ ищем матрицу $\mathbf T_\ell(\omega)\in\mathbb C^{2\times2}$, такую что

$$
\mathbf v(R_{\rm out},\omega)\approx \mathbf T_\ell(\omega)\,\mathbf v(R_{\rm in},\omega).
$$

## 5.2. Идентификация $\mathbf T_\ell$ из расчётов

Чтобы переопределить задачу, запускаются **две независимые реализации** при одной и той же геометрии и $\omega$, но с **разными источниками**:

* **Вариант S0:** $s_0(x)=g_\sigma(x)-\bar g$.
* **Вариант S1:** добавляем слабую «дипольную» модуляцию: $s_1(x)=s_0(x)\cdot (1+\epsilon\,(x-x_0)_z/R_{\rm ref})$, $\epsilon\in[0.05,0.1]$.

Получаем две пары $\mathbf v^{(0)}_{\rm in/out},\ \mathbf v^{(1)}_{\rm in/out}$ и восстанавливаем $\mathbf T_\ell$ как решение линейной системы (минимум-квадраты, если переопределено):

$$
[\mathbf v^{(0)}_{\rm out}\ \mathbf v^{(1)}_{\rm out}] \approx
\mathbf T_\ell\,[\mathbf v^{(0)}_{\rm in}\ \mathbf v^{(1)}_{\rm in}].
$$

## 5.3. Последовательная сборка и валидация

* Сборка: $\mathbf T_{\rm tot}(\omega)=\prod_{\ell=1}^{L_{\rm layers}}\mathbf T_\ell(\omega)$ в порядке слоёв.
* Проверка: для тестового запуска (S0) прогнозируем $\tilde{\mathbf v}(R_{\rm out}^{(\rm last)},\omega)=\mathbf T_{\rm tot}\,\mathbf v(R_{\rm in}^{(1)},\omega)$ и сравниваем с прямым расчётом.
* Метрики: относительная ошибка по норме $\le 10\%$ для $A$ и $\le 15\%$ для $A_r$ во всём диапазоне $\omega$; **вблизи пиков** $Y$: $\le 5\%$ по $A$.

---

# 6. Тестовые наборы и критерии приёмки

(**Все тесты обязательны**; каждый — отдельный юнит-тест, формирует отчёт и артефакты.)

## C1. Одна «стенка» и рождение резонанса

**Цель:** показать появление пиков $Y(\omega)$ и пространственных максимумов между ядром и стенкой.

* Конфиг: $L=32\pi$, $N\in\{256,384\}$, $\beta\in\{0.8,1.0,1.2\}$, $\nu=1$, $\lambda=0$.
* Геометрия: один слой $R_1=6\pi$, $\Delta R_1=3\Delta$.
* Память: $J=1$ **только в слое**: $\gamma_1=\gamma_{\rm layer}>0,\ \tau_1=\tau_{\rm layer}>0$.
* Свип по контрасту: $\eta_1\in\{0.0, 0.05, 0.1, 0.2, 0.3\}$ (подбирается через $\gamma,\tau$ на $\omega_{\rm ref}=1$).
* Свип по частоте: $\omega\in[0.05,5.0]$ (лог-шаг), локальное уточнение у пиков.

**Приёмка:**

1. При $\eta_1=0$ **нет** пиков с проминенсом ≥ 8 дБ.
2. При $\eta_1\ge 0.1$ — **есть** хотя бы один пик; сохранить $\omega_n,Q_n$.
3. Карта $A(r,\omega_n)$: максимум между $R_{\rm ref}$ и $R_1$ (локализация «ячейки»).
4. Пассивность: $P_\Omega(\omega)\ge0\ \forall\ \omega$.
5. Сходимость: изменение $\omega_n$ при $N$ от 256 к 384 ≤ 3%, $Q_n$ ≤ 10%.

---

## C2. Цепочка резонаторов и ABCD

**Цель:** показать поведение цепочки из 2–5 слоёв и согласование с ABCD-идентификацией.

* Геометрия: $L=40\pi$, $N=384$. Слои:
  $(R_\ell/\pi,\Delta R_\ell/\Delta)=$ (6,3), (9,3), (12,3), (15,3), (18,3).
* Параметры: одинаковые $\nu,\lambda$ везде; в слоях: $J=1$, $\gamma_\ell$ так, чтобы $\eta_\ell\in\{0.1,0.2\}$; $\tau_\ell\in[0.5,2.0]$ (по слоям).
* Частота: $[0.05,6.0]$, лог-шаг + уточнение на пиках.
* Идентификация $\mathbf T_\ell(\omega)$ по §5 (две реализации S0/S1 на каждой $\omega$).
* Сборка $\mathbf T_{\rm tot}$ и сравнение с прямым полным расчётом.

**Приёмка:**

1. Выделены ≥3 пиков $Y(\omega)$ с проминенсом ≥ 8 дБ.
2. Ошибка прогноза амплитуды на внешней сфере:
   $\max_\omega \frac{|A_{\rm sim}-A_{\rm ABCD}|}{|A_{\rm sim}|}\le 10\%$, и **на пиках** ≤ 5%.
3. Частоты пиков ABCD и прямого расчёта: $|\omega^{\rm ABCD}_n-\omega^{\rm sim}_n|/\omega^{\rm sim}_n\le 5\%$.
4. $Q_n$ согласованы в пределах 10%.

---

## C3. Пиннинг (память) и подавление дрейфа

**Цель:** показать, что при ненулевой $\gamma,\tau$ решётка огибающей «застывает» относительно дефекта.

* Геометрия: одна стенка (как в C1) **или** цепочка 2–3 слоёв (как в C2).
* Режим: **временной**. Источник: биения двух тонов с $\omega_1,\omega_2$ (см. C4), одинаковой амплитуды.
* Параметры памяти в слоях: свип по $\gamma\in[0,\,\gamma_{\max}]$, $\tau\in[0.3,\,3.0]$.
* Окно усреднения огибающей: $\Delta t_{\rm avg} = 10/(\omega_1+\omega_2)$.
* Оценка **скорости дрейфа узора** $v_{\rm cell}$: кросс-корреляция карт $I_{\rm eff}(x,t)=\text{MA}\{|a|^2\}$ в моменты $t$ и $t+\Delta t$; смещение максимума корреляции, делённое на $\Delta t$.

**Приёмка:**

1. При $\gamma=0$: $v_{\rm cell}\approx \Delta\omega/|\Delta k|$ (см. C4), отклонение ≤ 10%.
2. При $\gamma\ge\gamma^\*$ (порог, подбираемый в свипе):
   $v_{\rm cell}\le 10^{-3}\,L/T_0$ (считать «замороженным»).
3. Карты $I_{\rm eff}$ визуально инвариантны (Жаккар-индекс ≥ 0.95 на интервалах $\gg(\Delta\omega)^{-1}$).

---

## C4. Биения двух близких мод (база и с пиннингом)

**Цель:** измерить скорость дрейфа решётки и её подавление.

* Без слоёв (фон) **и** со слоями (раздельные наборы).
* Частоты: $\omega_{1,2}=\omega_0\pm \Delta\omega/2$, $\Delta\omega/\omega_0\in\{0.02,0.05\}$.
* Из k-спектра поля (FFT) извлечь $k_{1,2}$ (по максимумам моды l=0), тогда прогноз

  $$
  v_{\rm cell}^{\rm pred}=\frac{\Delta\omega}{|k_2-k_1|}.
  $$
* Из временной серии $I_{\rm eff}$ получить $v_{\rm cell}^{\rm num}$ (см. C3).

**Приёмка:**

1. **Без пиннинга:** $|v_{\rm cell}^{\rm num}-v_{\rm cell}^{\rm pred}|/v_{\rm cell}^{\rm pred}\le 10\%$.
2. **С пиннингом:** $v_{\rm cell}^{\rm num}/v_{\rm cell}^{\rm pred}\le 0.1$ (подавление ≥10×).

---

# 7. Конфиги (JSON) — примеры

## C1: одна стенка

```json
{
  "case": "C1_single_wall",
  "domain": {"L": 100.5309649, "N": 384},
  "physics": {"nu": 1.0, "beta": 1.0, "lambda": 0.0},
  "layers": [
    {"R_over_pi": 6.0, "thickness_in_cells": 3,
     "memory": [{"gamma": 0.4, "tau": 1.0}]}
  ],
  "source": {"type": "gaussian_neutralized", "sigma_cells": 2},
  "sweep": {"omega_min": 0.05, "omega_max": 5.0, "points_per_decade": 60,
            "refine_peaks": true},
  "output": {"dir": "out/C1", "save_profiles": true, "save_Y": true}
}
```

## C2: цепочка

```json
{
  "case": "C2_chain_5layers",
  "domain": {"L": 125.6637061, "N": 384},
  "physics": {"nu": 1.0, "beta": 1.2, "lambda": 0.0},
  "layers": [
    {"R_over_pi": 6.0,  "thickness_in_cells": 3, "memory": [{"gamma": 0.3, "tau": 0.7}]},
    {"R_over_pi": 9.0,  "thickness_in_cells": 3, "memory": [{"gamma": 0.2, "tau": 1.0}]},
    {"R_over_pi": 12.0, "thickness_in_cells": 3, "memory": [{"gamma": 0.3, "tau": 1.5}]},
    {"R_over_pi": 15.0, "thickness_in_cells": 3, "memory": [{"gamma": 0.25,"tau": 1.0}]},
    {"R_over_pi": 18.0, "thickness_in_cells": 3, "memory": [{"gamma": 0.35,"tau": 0.8}]}
  ],
  "source": {"type": "gaussian_neutralized", "sigma_cells": 2},
  "sweep": {"omega_min": 0.05, "omega_max": 6.0, "points_per_decade": 60, "refine_peaks": true},
  "abcdn": {"use_two_runs": true, "epsilon_dipole": 0.08},
  "output": {"dir": "out/C2", "save_profiles": true, "save_Y": true, "save_T_mats": true}
}
```

## C3/C4: биения и пиннинг

```json
{
  "case": "C3C4_beating_pinning",
  "domain": {"L": 100.5309649, "N": 384},
  "physics": {"nu": 1.0, "beta": 1.0, "lambda": 0.0},
  "layers": [{"R_over_pi": 6.0, "thickness_in_cells": 3, "memory": [{"gamma": 0.0, "tau": 1.0}]}],
  "time": {"dt": 5e-3, "T": 400.0, "avg_window": 0.8},
  "forcing_time": {
    "type": "two_tones",
    "omega0": 1.2, "delta_omega": 0.06,
    "amplitude": 1.0
  },
  "sweeps": {"gamma_list": [0.0, 0.2, 0.4, 0.6], "tau_list": [0.5, 1.0, 2.0]},
  "output": {"dir": "out/C3C4", "save_Ieff_series": true, "save_k_spectra": true}
}
```

---

# 8. Выходные данные и отчётность

* **Частотные серии:**
  `Y_layer{ℓ}.csv` (колонки: `omega, Y, P_layer, U_ref`),
  `modes.csv` (строки: `ℓ, n, omega_n, Q_n, prominence_dB`).
* **Поля/профили:** `A_r_profiles.h5` (группа на каждую $\omega$: массивы `r, A, Ar`).
* **ABCD:** `T_layer{ℓ}_omega{idx}.npy` (комплексные 2×2), `ABCD_validation.csv`.
* **Временные серии (C3/C4):** `Ieff_t.h5`, `xcorr_shifts.csv`, `vcells.csv`.
* **Итоги (JSON):** `metrics.json` с вердиктами по каждому тесту и допусками.
* **Графики:** `Y_peaks.png`, `A_vs_r_at_resonances.png`, `ABCD_vs_SIM.png`, `drift_vs_gamma.png`, `beating_vcell.png`.
* **Журнал:** `runs.csv` (конфиг-хэш, версии библиотек/ОС, статусы PASS/FAIL).

---

# 9. Критерии приёмки (сводно)

* **C1:**

  * При $\eta=0$ — нет пиков ≥ 8 дБ.
  * При $\eta\ge0.1$ — ≥1 пик; локализация максимума между ядром и стенкой.
  * Пассивность $P_\Omega(\omega)\ge0\ \forall\ \omega$.
  * Сходимость $\omega_n$ ≤ 3%, $Q_n$ ≤ 10% при увеличении $N$.

* **C2:**

  * ≥3 пиков $Y(\omega)$ ≥ 8 дБ.
  * Ошибки ABCD-прогноза: ≤10% (в целом), ≤5% на пиках; частоты пиков ≤5%, $Q$ ≤10%.

* **C3:**

  * Порог $\gamma^\*$: при $\gamma\ge\gamma^\*$ $v_{\rm cell}\le 10^{-3}\,L/T_0$.
  * Жаккар-индекс карт $I_{\rm eff}$ ≥ 0.95 на длинных окнах.

* **C4:**

  * Без пиннинга: $|v_{\rm cell}^{\rm num}-\Delta\omega/|\Delta k||/(\Delta\omega/|\Delta k|)\le10\%$.
  * С пиннингом: подавление ≥10×.

Любое нарушение → **FAIL** с развёрнутым отчётом и артефактами для диагностики.

---

# 10. Численные предосторожности

1. **Слои тонкие:** усредняйте по толщине для устойчивого `A_r`.
2. **Пики и проминенс:** оценивать на лог-шкале; фон — скользящее медианное окно (ширина ≥ 1/12 диапазона по $\log\omega$).
3. **Пассивность:** проверять численно неотрицательность $\Re\,\Gamma_{\rm mem}$ и $P_\Omega$.
4. **ABCD-идентификация:** при плохой обусловленности (почти коллинеарные $\mathbf v^{(0)}_{\rm in},\mathbf v^{(1)}_{\rm in}$) — перегенерировать S1 с другим $\epsilon$ или другим направлением «диполя».
5. **Сходимость:** подтверждать на $N=256$→$384$ (и/или $512$ на узких пиках).
6. **Временной шаг:** при явных частях ограничивать $\Delta t \le c / (\nu k_{\max}^{2\beta}+\lambda)$; рекомендуется экспоненциальный или CN.

---

# 11. Структура репозитория

```
/core
  solver_freq.py            # (ν(-Δ)^β + λ + iω + Γ_mem) a = s
  solver_time.py            # ∂t a + ν(-Δ)^β a + λ a + Σ γ m = s; τ ∂t m + m = a
  layers_masks.py
  power_metrics.py          # P_V, Y_ℓ, пассивность
  radial_state.py           # A(r), A_r(r), усреднения по сферам
  abcd_ident.py             # оценка T_ℓ(ω), сборка, валидация
  peaks_q_analyzer.py
  beating_drift.py          # I_eff, xcorr, v_cell
/tests
  test_C1_single_wall.py
  test_C2_chain_abcd.py
  test_C3_pinning_freeze.py
  test_C4_beating_drift.py
/configs
  C1_*.json
  C2_*.json
  C3C4_*.json
/out
  <артефакты>
```

---

# 12. Итог

“Уровень C” считается **выполненным**, когда все тесты C1–C4 имеют статус **PASS** с допусками из §9, сформированы отчёты и графики (§8), а проверки пассивности и сходимости пройдены.


---


---
%%7d-35%%
---

Привожу **строгое ТЗ для “Уровень E — устойчивость, чувствительность, масштабы и фазовая карта”**. Документ самодостаточен: ИИ-исполнитель пишет код, не зная теории, следуя только этому ТЗ.

---

# 0. Назначение

Численно подтвердить **робастность** выводов уровней A–D и определить **границы применимости** модели:

* **E1. Глобальная чувствительность параметров** (в т.ч. к пиннингу и контрастам).
* **E2. Робастность к шуму/неоднородностям и джиттеру геометрии.**
* **E3. Финитно-размерные и дискретизационные эффекты** (L, N, dt).
* **E4. Пределы и отказы** (edge-cases): пассивность, устойчивость, диагностика сбоев.
* **E5. Фазовая карта поведения** по $(\eta,\chi'',\beta)$ с классификацией режимов.
* **E6. Производительность и точность** (Pareto: время/память ↔ погрешность) + регрессионный пакет эталонов.

Выход: автотесты, отчёты, карты, метрики PASS/FAIL, «золотой» набор результатов для регрессии.

Зависимости: рабочие решатели и анализаторы уровней A–D.

---

# 1. Математическая постановка (кратко)

* Область $\Omega=[0,L)^3$, периодические ГУ, **float64**.
* Оператор/модель во времени и на частоте — как в уровнях C–D (с памятью в слоях $\Gamma_{\rm mem}$).
* Слои/оболочки: как в уровне C (1–5 шт.), параметры по областям.
* Источники: нейтрализованная гауссиана, узкие возбуждения, двухтоновый режим — по уровням B–D.

---

# 2. Параметры и диапазоны для свипов

Базовый набор (безразмерно):

* $\beta\in[0.6,1.4]$; $\nu=1$; $\lambda=0$ (если не оговорено).
* Цепочка 3 слоёв: $\ell=1..3$ с радиусами $R_\ell/\pi=(6,9,12)$, толщина $3\Delta$.
* Контрасты (через память слоя при $\omega_{\rm ref}=1$): $\eta_\ell\in[0,0.3]$.
* Память: $\gamma_\ell\in[0,0.8]$, $\tau_\ell\in[0.5,2.0]$.
* Домен $L\in\{32\pi,40\pi,48\pi\}$; сетки $N\in\{256,384,512\}$.
* Время: $dt\in[2.5\!\times\!10^{-3},1\!\times\!10^{-2}]$, длительность под задачу.
* Шум амплитуд: $\varepsilon\in[0,0.2]$ (0–20%).
* Джиттер радиусов слоёв: $\delta R\in\{0,\,\Delta,\,2\Delta\}$.
* Сид генератора: `seed=42` (репликации с разными seed оговорены в тестах).

---

# 3. Метрики и статистика

**Глобальные выходы (зависят от кейса):**

* $p$ — наклон хвоста $A(r)\sim r^{\,p}$ (B1).
* $r_{\rm core}, r_{\rm tail}$ (B4).
* $\{\omega_n,Q_n\}$ и пики $Y(\omega)$ (C1–C2).
* $v_{\rm cell}$ (дрейф решётки; C3–C4).
* Маски «горячих зон» и Жаккар $J$ (D1).
* Утечки между окнами $\mathrm{Leak}_{X\to Y}$ (D2).
* Хиральность $\mathcal A_\chi$ (D2).
* Пассивность: $P_\Omega(\omega)\ge0$ (C).
* Производительность: время, пик-RAM, масштабные показатели.

**Статистика:**

* Для случайностей — $M\ge 20$ репликаций (разные seeds).
* Оценки: $\text{median}$, IQR, 95% ДИ (percentile/bootstrap).
* Для глобальной чувствительности — **индексы Соболя** $S_i$ (первого порядка) и $T_i$ (тотальные).

---

# 4. Наборы тестов и приёмка

## E0. Среда, воспроизводимость, «золотой» эталон

**Цель:** детерминизм ± числ. шума, фиксация окружения.

* Записать версии библиотек/планов FFT/ОС; зафиксировать нормировки FFT (как в A).
* «Золотой» эталон: заново прогнать A0.1–A0.5, B1, C1, C2 (по одной конфигурации) → сохранить **golden\_metrics.json**.
  **Приёмка:** повторные перезапуски дают отклонения метрик ≤ допустимов уровней A–C.

---

## E1. Глобальная чувствительность параметров (Saltelli/Sobol)

**Цель:** ранжировать влияние $\theta=(\beta,\eta_1,\eta_2,\eta_3,\gamma_1,\gamma_2,\gamma_3,\tau_1,\tau_2,\tau_3)$ на ключевые выходы.

**Методика:**

* Объект: конфигурация C2 (3 слоя), $L=40\pi, N=384$.
* Пространство параметров — равномерные интервалы из §2.
* Дизайн: Saltelli LHS, база $N_s=1000$ точек (≈ $N_{\rm eval}\sim 11\,000$ прогонов для одного выхода).
* Выходы:
  (E1-a) $p$ (в режиме «космос» — слои выключены),
  (E1-b) $\omega_{1,2}$ и $Q_{1,2}$ (два первых пика),
  (E1-c) $v_{\rm cell}$ (биения без пиннинга и с пиннингом),
  (E1-d) $\max_{\!X\neq Y}\mathrm{Leak}_{X\to Y}$, $\mathcal A_\chi$ (WEAK-окно).

**Метрики:** $S_i, T_i$ + их 95% ДИ (bootstrap).

**Приёмка:**

* Устойчивость: повторный запуск с другим seed LHS даёт $|S_i^{(2)}-S_i^{(1)}|\le 0.05$ для топ-5 параметров.
* Физическая согласованность: $S_\beta$ среди топ-3 для $p$; для $Q$ — значимы хотя бы одна из $\{\eta_\ell,\gamma_\ell,\tau_\ell\}$.
* Числ. дисциплина: доля неуспешных прогонов ≤ 2% (см. E4).

---

## E2. Шум/неоднородности и джиттер геометрии

**Цель:** оценить деградацию метрик при реалистичных отклонениях.

**Варианты шума:**

* **Материальные поля:** $\nu(x)=\nu(1+\varepsilon\,\xi_\nu(x))$, $\gamma_\ell(x)=\gamma_\ell(1+\varepsilon\,\xi_\gamma(x))$,
  $\tau_\ell(x)=\tau_\ell(1+\varepsilon\,\xi_\tau(x))$; $\xi$ — нулесредние случайные поля с фильтрами по спектру:
  — white: $|\widehat\xi|=\text{const}$;
  — «красный»: $\propto 1/|k|$ (ограничить на малых/больших k);
  — полосовый: $k\in[k_1,k_2]$.
* **Источник:** фаза/амплитуда ±$\varepsilon$ (аддитивно).
* **Джиттер слоёв:** $R_\ell\to R_\ell+\delta R_\ell$, $\delta R_\ell\in\{-2\Delta,-\Delta,0,\Delta,2\Delta\}$.

**Протокол:** для $\varepsilon\in\{0.02,0.05,0.1,0.2\}$ и каждого типа шума → $M=20$ реализаций.

**Метрики:** смещения $\Delta p,\ \Delta r_{\rm core},\ \Delta r_{\rm tail},\ \Delta\omega_n,\ \Delta Q_n,\ \Delta v_{\rm cell}$; рост утечек; Жаккар $J$.

**Приёмка:**

* До $\varepsilon=0.1$: медианные $|\Delta\cdot|$ не превышают 20% допусков уровней B–D; $J\ge 0.8$ (каркас устойчив).
* До $\varepsilon=0.2$: ни одна метрика не выходит за пределы ×2 допусков B–D; пассивность $P_\Omega(\omega)\ge0$ не нарушена.

---

## E3. Финитно-размерные эффекты и дискретизация

**Цель:** исключить артефакты $L,N,dt$.

**E3-a (масштаб домена):**

* Кейсы: B1 (хвост), C2 (цепочка), D2 (окна).
* Сравнить $L=32\pi,40\pi,48\pi$ при фиксированном $\Delta = L/N$ (т.е. $N$ пропорционально $L$).
* **Приёмка:** смены $p,\ \omega_n,\ Q_n,\ v_{\rm cell}$ ≤ 2–3% (в пределах допусков уровней) между соседними L.

**E3-b (сходимость по сетке):**

* $N=256\to384\to512$ при фиксированном $L$.
* **Приёмка:** оценка порядка: $\text{EOC}=\log\frac{\|u_{256}-u_{384}\|}{\|u_{384}-u_{512}\|}/\log(384/256)\in[1.8,2.2]$ для поля и ключевых скалярных метрик.

**E3-c (шаг по времени):**

* Для временных задач (C3–C4, D3) сравнить $dt\in\{10^{-2},5\!\times\!10^{-3},2.5\!\times\!10^{-3}\}$.
* **Приёмка:** метрики $v_{\rm cell}, \mathbf R_{\rm cm}$ и др. меняются ≤ 3%.

---

## E4. Пределы и отказы (edge-cases)

**Цель:** зафиксировать корректные реакции кода при некорректных/экстремальных настройках.

* **Нарушение пассивности:** принудительно задать $\Re\,\Gamma_{\rm mem}<0$ на части диапазона → ожидаемый **FAIL** с сообщением:
  *"Пассивность нарушена: Re(Γ\_mem)<0 при ω=... в слое ℓ=..."*.
* **Сингулярная нулевая мода:** $\lambda=0$ и $\widehat s(0)\ne0$ → **FAIL** как в A0.3.
* **Чрезмерные контрасты:** $\eta_\ell>0.5$ → контролировать числ. устойчивость и сохранение $P_\Omega\ge0$; при нарушении — **FAIL**.
* **Таймауты/ресурсы:** при нехватке памяти/времени — корректный прерывающий лог и частичный дамп полей.

**Приёмка:** все ожидаемые FAIL детектируются, сообщения осмысленные; непредусмотренных падений нет.

---

## E5. Фазовая карта поведения

**Цель:** построить карту режимов на плоскости $(\eta,\chi'')$ при фиксированных $\beta\in\{0.8,1.0,1.2\}$.

**Режимы (ярлыки):**

* **PL** (power-law): нет резонансов (Y без пиков ≥ 8 dB).
* **R1/Rk**: 1…k отчётливых пиков.
* **FRZ**: «заморозка» ( $v_{\rm cell}\le 10^{-3} L/T_0$ ).
* **LEAK**: $\max_{X\neq Y}\mathrm{Leak}_{X\to Y}>0.1$.

**Методика:**

* Сетка $\eta\in[0,0.3]$ × $\chi''\in[0,0.8]$ (шаги 0.02–0.04); для каждой точки — частотный свип, диагностика.
* Обучить простую логистическую регрессию/дерево для границ PL↔R, R↔FRZ, FRZ↔LEAK (по агрегированным метрикам).

**Приёмка:**

* Доли правильной классификации ≥ 0.9 (k-fold=5);
* Границы монотонны по $\eta$ (не убывают) и по $\chi''$ (для FRZ граница не убывает по $\chi''$);
* Повторный прогон (другой seed шумов) меняет границы ≤ 5% по координатам.

---

## E6. Производительность, масштабируемость и регрессия

**E6-a (масштабирование):**

* Измерить время/память для базовых кейсов B1, C2, D2 на $N=256,384,512$.
* Аппроксимировать $\,t(N)\approx c\,N^3\log N$, $M(N)\approx c_M N^3$.
* **Приёмка:** относит. ошибка аппроксимации ≤ 10%; отчёт с коэффициентами $c,c_M$.

**E6-b (Pareto время ↔ точность):**

* Для ключевых метрик ( $p,\ \omega_1,\ Q_1,\ v_{\rm cell}$ ) построить кривые зависимости ошибки от затраченного времени (из E3).
* **Приёмка:** предоставить рекомендованные профили (напр., «быстрый/средний/точный»), с ожидаемыми ошибками ≤ (3%, 1.5%, 0.7%).

**E6-c (регрессия):**

* Собрать «золотой» пакет (E0) + реперные случаи E1–E5 → `golden/*`.
* Автотесты сравнивают текущие метрики с `golden_metrics.json`.
* **Приёмка:** все регрессионные тесты PASS.

---

# 5. Конфиги (JSON) — примеры

## E1 (Sobol)

```json
{
  "case": "E1_sensitivity_sobol",
  "domain": {"L": 125.6637061, "N": 384},
  "physics": {"nu": 1.0, "lambda": 0.0},
  "layers": {"count": 3, "R_over_pi": [6.0, 9.0, 12.0], "thickness_in_cells": 3},
  "priors": {
    "beta": [0.6, 1.4],
    "eta":  [[0.0, 0.3],[0.0,0.3],[0.0,0.3]],
    "gamma":[[0.0, 0.8],[0.0,0.8],[0.0,0.8]],
    "tau":  [[0.5, 2.0],[0.5,2.0],[0.5,2.0]]
  },
  "saltelli": {"Nsamples_base": 1000, "seed": 42},
  "outputs": ["p_tail","omega1","Q1","omega2","Q2","vcell","leak_max","Achi"],
  "output_dir": "out/E1"
}
```

## E2 (шум/джиттер)

```json
{
  "case": "E2_noise_jitter",
  "domain": {"L": 125.6637061, "N": 384},
  "physics": {"nu": 1.0, "beta": 1.0, "lambda": 0.0},
  "layers": [/* 3 слоя как в C2 */],
  "noise": {
    "eps_list": [0.02, 0.05, 0.10, 0.20],
    "types": ["white","red","band"],
    "apply_to": ["nu","gamma","tau","source_amp","source_phase"]
  },
  "jitter": {"deltaR_cells": [0,1,2]},
  "replications": 20,
  "output_dir": "out/E2"
}
```

## E3 (L,N,dt)

```json
{
  "case": "E3_size_discretization",
  "domains": [{"L": 100.5309649, "N": 256},
              {"L": 125.6637061, "N": 384},
              {"L": 150.7964474, "N": 512}],
  "physics": {"nu": 1.0, "beta": 1.2, "lambda": 0.0},
  "time_steps": [0.01, 0.005, 0.0025],
  "output_dir": "out/E3"
}
```

## E5 (фазовая карта)

```json
{
  "case": "E5_phase_map",
  "domain": {"L": 125.6637061, "N": 384},
  "physics": {"nu": 1.0, "lambda": 0.0},
  "betas": [0.8, 1.0, 1.2],
  "grid": {"eta": {"min":0.0, "max":0.3, "step":0.02},
           "chi_pp": {"min":0.0, "max":0.8, "step":0.04}},
  "class_thresholds": {"peak_prom_db": 8.0, "freeze_vcell": 1e-3, "leak_max": 0.1},
  "output_dir": "out/E5"
}
```

## E6 (масштабирование/регрессия)

```json
{
  "case": "E6_perf_regression",
  "domains": [{"L": 100.5309649, "N": 256},
              {"L": 125.6637061, "N": 384},
              {"L": 150.7964474, "N": 512}],
  "benchmarks": ["B1","C2","D2"],
  "golden_dir": "golden",
  "output_dir": "out/E6"
}
```

---

# 6. Выходные данные и отчётность

* **Метрики (JSON):** `E1_sobol.json` (векторы $S_i,T_i$ + ДИ), `E2_noise_stats.json`, `E3_convergence.json`, `E4_failures.json`, `E5_phase_map.json`, `E6_perf.json`.
* **Таблицы (CSV):** результаты свипов, сводные таблицы режимов.
* **Карты/графики:** `phase_map.png`, `sobol_bars.png`, `noise_robustness.png`, `convergence_plots.png`, `pareto_curves.png`.
* **«Золотой» пакет:** `golden/golden_metrics.json` + связанные артефакты.
* **Логи:** `runs.csv` (конфиг-хэши, сиды, версии, PASS/FAIL).

---

# 7. Критерии приёмки (сводно)

* **E0:** эталонные кейсы воспроизводятся в допусках уровней A–C.
* **E1:** стабильные индексы Соболя (топ-5 разброс ≤ 0.05); ожидаемые параметры значимы для соответствующих выходов.
* **E2:** до $\varepsilon=0.1$ — деградации ≤ 20% от допусков; до $\varepsilon=0.2$ — не хуже ×2; пассивность не нарушена.
* **E3:** инвариантность к L, ожидаемая сходимость по N, стабильность по dt (см. §4).
* **E4:** все предусмотренные ошибки детектируются и корректно логируются; непредусмотренных падений — нет.
* **E5:** точность классификации ≥ 0.9; границы монотонны; вариабельность границ ≤ 5%.
* **E6:** масштабирование аппроксимируется с ошибкой ≤ 10%; регрессия **PASS**.

Любое нарушение → **FAIL** с развёрнутым отчётом и артефактами.

---

# 8. Численные предосторожности

1. Пассивность: контролировать $P_\Omega(\omega)\ge0$ и $\Re\,\Gamma_{\rm mem}\ge0$ при любых свипах.
2. Шумовые поля: удалять нулевую моду при $\lambda=0$; нормировать дисперсию перед фильтрацией по спектру.
3. Соболь: вектор выходов центрировать/масштабировать; проверять стабильность индексов при увеличении базы $N_s$.
4. Конвергенция: для E3-b использовать одинаковые фильтры/операторы на разных N; сравнивать на общей под-сетке.
5. Тайм-менеджмент: ограничивать суммарный бюджет прогонов; при превышении — приоритизировать точки у границ режимов (E5).
6. Повторяемость: хранить сиды и хэши конфигов в `runs.csv`.

---

# 9. Структура репозитория

```
/core
  sobol_sensitivity.py      # Saltelli/LHS, S_i, T_i, bootstrap CI
  noise_fields.py           # генерация ξ(x) с заданным спектром
  jitter_geometry.py        # джиттер радиусов слоёв
  convergence_tools.py      # EOC, сравнение на под-сетке
  phase_classifier.py       # метки PL/Rk/FRZ/LEAK, обучение границ
  perf_profiler.py          # замер времени/памяти, аппроксимации
/tests
  test_E0_repro_golden.py
  test_E1_sensitivity.py
  test_E2_noise_jitter.py
  test_E3_convergence.py
  test_E4_failures.py
  test_E5_phase_map.py
  test_E6_perf_regression.py
/configs
  E1_*.json
  E2_*.json
  E3_*.json
  E5_*.json
  E6_*.json
/golden
  golden_metrics.json
/out
  <артефакты>
```

---

# 10. Итог

“Уровень E” считается **выполненным**, когда все тесты E0–E6 имеют статус **PASS** по допускам §7, отчёты и карты сформированы (§6), пассивность/устойчивость подтверждены, «золотой» пакет собран и регрессионные проверки проходят.


---

---
%%7d-36%%
---


Привожу **строгое ТЗ для “Уровень F — динамика, инерция и столкновения дефектов”**. Документ самодостаточен: ИИ-исполнитель пишет код, не зная теории, следуя только этому ТЗ. Структура — как для уровней A–E.

---

# 0. Назначение

Численно подтвердить и количественно описать динамику дефектов в БВП:

* **F0. Валидация динамики** (интеграторы, память, источники/«ловушки»).
* **F1. Подвижность, гиротермин и вязкое трение** (устоявшийся дрейф от постоянной «силы»).
* **F2. Эффективная масса (инерция)** — по частотной передаточной функции и по импульсной реакции.
* **F3. «Инерция = сложность»** — зависимость $M_{\rm eff}$ от сложности дефекта/среды.
* **F4. Столкновения** (лобовые/косые, разные заряды/фазы) и диаграммы исходов.
* **F5. Столкновения в ячеистой среде** (отражение/захват/туннелирование на цепочке резонаторов).
* **F6. Балансы энергии/импульса и пассивность** (радиация, рассеяние).

Выход: автотесты, отчёты, графики, файлы артефактов, PASS/FAIL по критериям.

Зависимости: рабочие решатели A–E (FFT/стац./частотный/временной, слои/память, ABCD, метрики).

---

# 1. Математическая постановка (динамика)

## 1.1. Временная модель

Поле $a(x,t)\in\mathbb C$, $\Omega=[0,L)^3$, периодические ГУ, **float64**:

$$
\partial_t a + \nu(-\Delta)^\beta a + \lambda a + \sum_{j=1}^J \gamma_j(x)\,m_j = s(x,t),\qquad
\tau_j(x)\,\partial_t m_j + m_j = a.
$$

Параметры как в C–D. Пассивность: $\Re\sum_j \tfrac{\gamma_j}{1+i\omega\tau_j}\ge0$.

## 1.2. «Сила», ловушка и импульс

Дефект двигаем **безвихревым внешним воздействием** через источник и/или маску памяти:

* **Ловушка** $W(x-X_d(t))$: локальная область пониженных потерь/повышенной «поддержки» поля.
* **Сдвиг ловушки** $X_d(t)$ задаёт «внешнюю силу» $F(t)$ на дефект.
* **Импульс-пинок**: кратковременный наклон фазы в окрестности дефекта:
  $a\leftarrow a\cdot \exp\{i\,\kappa\,\psi(x;X_0)\}$ на интервале $[t_0,t_0+\Delta t]$.

## 1.3. Коллективные координаты (для диагностики)

* **Положение дефекта** $X(t)$: минимум $|a|$ с локальной рефитом параболой **или** центр фазовой обмотки (по 2D-срезу).
* **Скорость/ускорение:** $V=\dot X,\ A=\ddot X$ (разностная формула 2-го порядка, сглаживание S-G, окно ≥ 9 шагов).
* **Энергия и мощность:** как в C (плотность диссипации + работа источника).
* **Псевдоимпульс:** $\mathbf P=\int \Im(\overline{a}\,\nabla a)\,dx$ (для балансов).

---

# 2. Метрики динамики и «инерции»

## 2.1. Модель отклика дефекта (Thiele-Newton surrogate)

В 2D-плоскости сечения (движение дефекта):

$$
\underbrace{M_{\rm eff}\,\dot V}_{\text{инерция}} \;+\;
\underbrace{D\,V}_{\text{вязкое}} \;+\;
\underbrace{\mathbf G\times V}_{\text{гиро}} \;+\;
\nabla U(X) \;=\; F_{\rm ext}(t),
$$

где $M_{\rm eff}$ — искомая эффективная масса; $D$ — трение; $\mathbf G=G\,\hat z$.

## 2.2. Извлечение $D, G$ (устоявшийся дрейф)

При постоянном $F=F_0\mathbf e_x$: стационарно $M_{\rm eff}\dot V=0$, получаем

$$
\begin{bmatrix} V_x\\ V_y \end{bmatrix}
= \mu
\begin{bmatrix} 1 & -\xi \\ \xi & 1 \end{bmatrix}
\begin{bmatrix} F_0 \\ 0 \end{bmatrix},\qquad
\mu=\frac{D}{D^2+G^2},\ \ \xi=\frac{G}{D}.
$$

Отсюда

$$
D=\frac{F_0}{V_x+ \frac{V_y^2}{V_x}},\qquad
G=\frac{F_0\,V_y}{V_x^2+V_y^2}.
$$

## 2.3. Извлечение $M_{\rm eff}$ (частотный и импульсный методы)

* **Частотный:** задаём $F(t)=F_1\cos(\Omega t)\mathbf e_x$ (малая амплитуда). Фитируем комплексную подвижность

$$
\chi(\Omega)=\frac{V_x(\Omega)}{F_1}
=\frac{1}{D+i G + \frac{K}{i\Omega} - i M_{\rm eff}\Omega},
$$

где $K$ — слабая «жёсткость» ловушки (известна конфигом). Фит нелинейный по $M_{\rm eff},D,G$.

* **Импульсный:** пинок на $\Delta t\ll T$: измеряем $V(t)$, аппроксимируем раннюю стадию

$$
V_x(t)\approx \frac{\Delta P}{M_{\rm eff}}\,e^{-t/\tau_D},\quad \tau_D=\frac{M_{\rm eff}}{D}.
$$

Сверяем $M_{\rm eff}$ из двух методов (см. приёмку).

## 2.4. Индекс сложности дефекта/среды

$$
\mathcal C = \alpha_1|q| + \alpha_2 N_{\rm modes} + \alpha_3\!\sum_n Q_n + \alpha_4\!\sum_\ell \eta_\ell,
$$

где $q$ — обмотка; $N_{\rm modes}$ — число пиков $Y(\omega)$ ≥ порога; $Q_n$ — добротности; $\eta_\ell$ — контрасты слоёв (все извлекаются на C–D). Коэффициенты по умолчанию $\alpha_i=1$.

---

# 3. Наборы тестов и приёмка

(**Все обязательны**; каждый — отдельный юнит-тест, отчёты и артефакты.)

## F0. Валидация динамики

**Цель:** корректность интеграторов и ловушки/пинка.

* Гармоническая плоская волна: сверка с аналитикой (как A0.4) — ошибка ампл./фазы ≤ $10^{-8}$.
* Память: тест Дебая (ступенчатый вход) — экспоненциальная релаксация с заданной $\tau$ (ошибка времени релаксации ≤ 2%).
* Ловушка: стационарный сдвиг $X_d$ ⇒ дефект смещается на $\approx X_d$ (ошибка ≤ 2% при малой $K$).

**Приёмка:** все подпункты PASS.

---

## F1. Подвижность, $D$ и $G$

**Цель:** извлечь $D, G$ из устоявшегося дрейфа.

* Среда: однородная **и** с одной стенкой (как C1).
* Воздействие: постоянный $F_0\mathbf e_x$ (медленный сдвиг ловушки).
* Процедура: измерить $V=(V_x,V_y)$, вычислить $D,G$ по §2.2.
* Сходимость: повтор на $N=256\to384$ (изменение ≤ 5%).

**Приёмка:** стабильность $D,G$ при варьировании $F_0$ в ×3 — drift ≤ 5%; $P_\Omega\ge0$.

---

## F2. Эффективная масса $M_{\rm eff}$

**Цель:** доказать «инерциальность» дефекта.

* **F2-A (частотный):** sweep $\Omega\in[\Omega_{\min},\Omega_{\max}]$ (лог-шаг), малый сигнал; фит $\chi(\Omega)$ → $M_{\rm eff},D,G,K$.
* **F2-B (импульсный):** пинок, оценка $M_{\rm eff}$ из раннего $V(t)$.
* **Согласование:** $|M_{\rm eff}^{(\mathrm{A})}-M_{\rm eff}^{(\mathrm{B})}|/\bar M \le 10\%$.

**Приёмка:** $R^2$ фита ≥ 0.98; параметры устойчивы к сетке (≤ 5%).

---

## F3. «Инерция = сложность»

**Цель:** проверить гипотезу роста $M_{\rm eff}$ с $\mathcal C$.

* Свип по: $|q|\in\{1,2\}$; числу слоёв $L\in\{0,1,3,5\}$; $\eta_\ell$ и $Q_n$ (через $\gamma,\tau$).
* Для каждой конфигурации: найти $\mathcal C$ (из C–D), затем $M_{\rm eff}$ (F2).
* Линейно-лог/лог-лог-регрессии $M_{\rm eff}=f(\mathcal C)$; корреляции Пирсона/Спирмена.

**Приёмка:** $\rho,\rho_s \ge 0.7$; наклон положительный в 95% ДИ; out-of-fold RMSE ≤ 15%.

---

## F4. Столкновения

**Цель:** классифицировать исходы и собрать диаграммы.

* Пары дефектов: $(q_1,q_2)\in\{(1,1),(1,-1),(2,-1)\}$; относительная фаза $\Delta\phi\in\{0,\pi/2,\pi\}$.
* Начальное состояние: два дефекта на расстоянии $R_0$ ≫ ядра (сборка полей + краткая релаксация), задать начальные скорости $V_0$ либо «подпихом» ловушек.
* Свип: $V_0$ (0.01…0.2), **ударный параметр** $b$ (0…$5\xi$).
* **Классы исходов:** эластическое рассеяние (угол $\theta$), захват (связанная пара), аннигиляция (для $q_1=-q_2$), обмен/«сквозное» прохождение.
* Метрики: $\theta(b,V_0,\Delta\phi)$, время взаимодействия, излучённая энергия $E_{\rm rad}$, изменение $M_{\rm eff}$ до/после, карта вероятностей исходов.

**Приёмка:** воспроизводимость (повтор с другим seed — доли классов ±5%); балансы энергии (см. F6) ≤ 3%.

---

## F5. Столкновения в ячеистой среде

**Цель:** влияние цепочки резонаторов на динамику.

* Геометрия: C2 (3–5 слоёв).
* Кейсы: (i) дефект ↔ стенка (отраж./захват), (ii) дефект ↔ дефект внутри/между ячейками.
* Метрики: коэффициенты отражения/захвата, «критическая» энергия для прохождения (порог $V_0$), зависимость от $\eta$ и расположения ячеек.

**Приёмка:** монотонность порога по $\eta$ (не убывает), карты исходов устойчивы при $N=256\to384$ (изменения ≤ 5%).

---

## F6. Балансы и пассивность

**Цель:** подтверждение физкорректности динамики.

* Считать: $E(t)=\int \big(\nu|(-\Delta)^{\beta/2}a|^2 + \lambda|a|^2 + \sum_j \Re\tfrac{\gamma_j}{1+i\omega\tau_j}|a|^2\big)dx$.
* Мощность источника $P_s=\Re\int \overline{s}\,a_t\,dx$; радиация $P_{\rm rad}$ — через изменение $E$: $dE/dt=P_s-P_{\rm diss}$.
* Проверки: $E(t)$ не возрастает без источника; $P_{\rm diss}\ge0$; интегральный баланс закрывается ≤ 3%.

**Приёмка:** все балансы PASS; при коллизиях суммарная потеря энергии = радиация+диссипация (невязка ≤ 3%).

---

# 4. Конфиги (JSON) — примеры

## F1 (подвижность)

```json
{
  "case": "F1_mobility_gyro",
  "domain": {"L": 100.5309649, "N": 384},
  "physics": {"nu": 1.0, "beta": 1.0, "lambda": 0.0},
  "layers": [],
  "trap": {"type": "gauss", "K": 0.02, "radius_cells": 6},
  "drive": {"type": "constant", "Fx": 0.01},
  "tracking": {"method": "min_abs_or_winding", "sg_window": 9},
  "output": {"dir": "out/F1"}
}
```

## F2 (масса)

```json
{
  "case": "F2_mass_both_methods",
  "domain": {"L": 100.5309649, "N": 384},
  "physics": {"nu": 1.0, "beta": 1.0, "lambda": 0.0},
  "layers": [{"R_over_pi": 6.0, "thickness_in_cells": 3, "memory": [{"gamma": 0.3, "tau": 1.0}]}],
  "trap": {"type": "gauss", "K": 0.03, "radius_cells": 6},
  "drive": {"type": "sine", "Fx": 0.01, "Omega_range": [0.02, 0.8], "ppd": 40},
  "kick": {"kappa": 0.4, "duration": 0.1},
  "output": {"dir": "out/F2"}
}
```

## F3 (инерция-сложность)

```json
{
  "case": "F3_mass_vs_complexity",
  "sweep": {"q_list": [1,2], "layers_list": [0,1,3,5], "eta": [0.0,0.1,0.2,0.3], "tau": [0.5,1.0,1.5]},
  "reuse_C_D": true,
  "output": {"dir": "out/F3"}
}
```

## F4 (столкновения)

```json
{
  "case": "F4_collisions",
  "domain": {"L": 125.6637061, "N": 384},
  "physics": {"nu": 1.0, "beta": 1.0, "lambda": 0.0},
  "layers": [],
  "pairs": [{"q1": 1, "q2": -1}, {"q1": 1, "q2": 1}],
  "init": {"R0": 25.0, "V0_list": [0.03,0.06,0.12,0.18], "b_list": [0.0, 2.0, 4.0, 6.0], "dphi_list": [0, 1.571, 3.142]},
  "output": {"dir": "out/F4"}
}
```

## F5 (столкновения в цепочке)

```json
{
  "case": "F5_collisions_in_chain",
  "domain": {"L": 125.6637061, "N": 384},
  "physics": {"nu": 1.0, "beta": 1.2, "lambda": 0.0},
  "layers": [/* 3-5 слоёв как в C2 */],
  "init": {"R0": 25.0, "V0_list": [0.03,0.06,0.12], "b_list": [0.0,3.0,6.0]},
  "output": {"dir": "out/F5"}
}
```

---

# 5. Выходные данные и отчётность

* **Траектории/скорости:** `tracks.csv` (t, X, Y, Vx, Vy, Ax, Ay), `tracks.npz`.
* **Масса/мобильность:** `mobility.json` (D,G, μ, ξ), `mass_fit.json` (M\_eff, K, R2), `mass_impulse.json`.
* **Коллизии:** `collisions_summary.csv` (класс исхода, θ, T\_int, E\_rad, V0, b, Δφ), `phase_maps/*.png`.
* **Энергетика:** `energy_balance.csv`, `power_timeseries.csv`.
* **Графики:** `vxvy_vs_F.png`, `mobility_lissajous.png`, `mass_fit_bode.png`, `impulse_decay.png`, `collision_outcomes_map.png`.
* **Итоги (JSON):** `metrics.json` со статусами PASS/FAIL по F0–F6.
* **Журнал:** `runs.csv` (конфиг-хэши, сиды, версии).

---

# 6. Критерии приёмки (сводно)

* **F0:** все базовые динамические тесты PASS (см. раздел).
* **F1:** устойчивые $D,G$ — варьирование $F_0$ в ×3 меняет оценки ≤ 5%; сходимость по сетке ≤ 5%.
* **F2:** согласие масс двух методов ≤ 10%; $R^2$ частотного фита ≥ 0.98.
* **F3:** $\rho,\rho_s\ge 0.7$, положительный наклон $M_{\rm eff}(\mathcal C)$ (95% ДИ).
* **F4:** воспроизводимость диаграмм исходов (±5%); баланс энергии ≤ 3%.
* **F5:** критический порог прохождения не убывает с ростом $\eta$; устойчивость к сетке ≤ 5%.
* **F6:** пассивность и энергетический баланс PASS во всех экспериментах.

Любое нарушение → **FAIL** с развёрнутым отчётом и артефактами.

---

# 7. Численные предосторожности

1. Пошаговая устойчивость: экспоненциальный интегратор или CN; при явном компоненте — ограничение $\Delta t \le c/(\nu k_{\max}^{2\beta}+\lambda)$.
2. Трекинг дефекта: комбинировать минимум $|a|$ с проверкой фазовой обмотки; отбрасывать кадры, где две «дырки» сближаются < $3\Delta$.
3. Ловушка: выбирать $K$ так, чтобы частота ловушки лежала **ниже** рабочего диапазона $\Omega$ в F2; $K$ известна и входит в фит.
4. Импульс: длительность «пинка» $\Delta t$ ≪ периода доминирующих мод; оценивать ранний участок до $t\approx 2\tau_D$.
5. Коллизии: домен должен вмещать траектории и «радиационный хвост» (L ≥ 6–8 радиусов ядра); PML не нужен при периодике, но анализ окна — до $L/3$.
6. Пассивность: контролировать $P_\Omega\ge0$ и $\Re\Gamma_{\rm mem}\ge0$ в каждом кейсе.
7. Сходимость: ключевые оценки повторять на $N=256\to384$ (при узких феноменах — до 512).

---

# 8. Структура репозитория

```
/core
  time_solver.py           # ∂t a + … + Σγ m = s; τ ∂t m + m = a
  traps_and_drives.py      # ловушки, силы, пинки
  tracker.py               # поиск X(t), V(t), A(t)
  mobility_gyro.py         # оценка D,G по устоявшемуся дрейфу
  mass_estimators.py       # частотный фит χ(Ω), импульсный метод
  collisions.py            # инициализация пар, свипы по V0,b,Δφ
  energy_balance.py        # E(t), P_s, P_diss, радиация
/tests
  test_F0_validation.py
  test_F1_mobility.py
  test_F2_mass.py
  test_F3_mass_vs_complexity.py
  test_F4_collisions.py
  test_F5_collisions_in_chain.py
  test_F6_balances.py
/configs
  F1_*.json
  F2_*.json
  F3_*.json
  F4_*.json
  F5_*.json
/out
  <артефакты>
```

---

# 9. Итог

“Уровень F” считается **выполненным**, когда все тесты F0–F6 имеют статус **PASS** с допусками раздела 6, сформированы отчёты и графики (раздел 5), соблюдены предосторожности (раздел 7), а оценки $M_{\rm eff}$ согласованы между частотным и импульсным методами и демонстрируют статистически значимую зависимость от сложности $\mathcal C$.

---

---
%%7d-37%%
---


Коротко: **да — делаем “Уровень G: инверсия и валидация паспортов (e, p, n)”**. Ниже полное ТЗ в том же стиле, чтобы из наблюдаемых получать параметры модели и выдавать «паспорт частицы».

---

# Уровень G — инверсия и валидация “электрон / протон / нейтрон”

Документ самодостаточен: ИИ-исполнитель пишет код, не зная теории, следуя только этому ТЗ.

## 0. Назначение

1. **Инверсия:** по наблюдаемым метрикам $\mathcal{O}$ (спектры $Y(\omega)$, хвост, поля, динамика) восстановить параметры $\theta$ модели ВБП.
2. **Валидация:** проверить согласие вне обучающего набора (posterior-predictive), запустить фальсифицирующие тесты.
3. **Паспорта частиц:** для e, p, n — сводные таблицы $\hat\theta$, «качество подгонки», предсказанные неиспользованные метрики.

Выход: автотесты, отчёты, графики, файлы артефактов, статусы PASS/FAIL.

---

## 1. Наблюдаемые $\mathcal{O}$ (входные данные)

Минимально требуемые наборы (все — в безразмерных или нормированных единицах):

* **Статика/частота:** хвост $A(r)$ → наклон $p$; слоевые адмиттансы $Y_\ell(\omega)$ → пики $\{\omega_n,Q_n\}$, проминенсы.
* **Пространство:** карта $I_{\rm eff}(x)$, маска «горячих зон», радиусы зон $r_{\rm core},r_{\rm tail}$.
* **Динамика:** подвижность $D,G$ (устоявшийся дрейф), эффективная масса $M_{\rm eff}$ (частотный/импульсный методы), $v_{\rm cell}$ (при/без пиннинга).
* **Хиральность/EM-прокси:** $\mathcal A_\chi$, радиальный поток $J_r(R)$, магнитный момент-прокси $\mu\propto\int \mathbf r\times\mathbf j\,dV$.
* **Коллизии (по возможности):** исходы $\{$рассеяние/захват/аннигиляция$\}$ vs $b,V_0,\Delta\phi$.

Формат: CSV/JSON/HDF5, описан в §7.

---

## 2. Параметры модели $\theta$ (что ищем)

$$
\theta=\{\beta;\ (R_\ell,\Delta R_\ell)_{\ell=1..L};\ \eta_\ell;\ \gamma_\ell,\tau_\ell;\ q;\ \text{амплитудные калибровки}\}.
$$

* $\beta$ — фракц. порядок (хвост).
* $R_\ell,\Delta R_\ell$ — геометрия слоёв, $L=0..5$.
* $\eta_\ell$ — контрасты (через память при $\omega_{\rm ref}$).
* $\gamma_\ell,\tau_\ell$ — параметры памяти/пиннинга.
* $q$ — обмотка/топологический «заряд» (целое).
* (Опционально) глобальные коэффициенты пересчёта единиц массы/заряда для сопоставления с физическими эталонами — задаются отдельно, см. §5.3.

---

## 3. Поток инверсии

### 3.1. Предобработка → «сырой» вектор метрик

Из файлов наблюдаемых вычислить:

$$
\mathbf m_{\rm obs} = [p;\ (\omega_n,Q_n)_{n\le N_p};\ J_r(R_i);\ \mathcal A_\chi;\ D,G;\ M_{\rm eff}^{\rm freq},M_{\rm eff}^{\rm imp};\ v_{\rm cell};\ r_{\rm core},r_{\rm tail};\ \mu\_{\rm proxy};\ \dots]
$$

### 3.2. Прямой решатель предсказаний

Для заданной $\theta$ вычислить:

$$
\mathbf m_{\rm mod}(\theta) \quad \text{модулями уровней A–F (стац./част., ABCD, динамика).}
$$

### 3.3. Функция несоответствия (целевая)

$$
\mathcal L(\theta)=\sum_k w_k\, d_k\Big(m_{{\rm obs},k},\, m_{{\rm mod},k}(\theta)\Big),
$$

где $d_k$ — масштаб-инвариантные расстояния: относит. ошибка, угловая метрика (для профилей/карт), 1-минус $R^2$ (для регрессий), 1-минус Жаккар (для масок).

### 3.4. Регуляризация и priors

* Регуляризация геометрии: штраф за «слипание» слоёв $\sum_\ell \max(0,\ R_{\ell-1}{+}\Delta R_{\ell-1}-R_\ell)^2$.
* Пассивность: барьерная функция за $\Re\,\Gamma_{\rm mem}(\omega)<0$.
* Priors (равномерные, см. §6-конфиги):
  $\beta\in[0.6,1.4],\ L\in[0,5],\ \eta_\ell\in[0,0.3],\ \gamma_\ell\in[0,0.8],\ \tau_\ell\in[0.5,2.0],\ q\in\{-2..2\}$.

### 3.5. Алгоритм оптимизации

* Грубая фаза: **LHS/Sobol** выборка $\theta$, топ-K в локальную оптимизацию (L-BFGS-B/Trust-Constr).
* Байес-оценка (опц.): NUTS/SMC на сглаженной $\mathcal L$ → постериор среднего и ДИ.
* Идентифицируемость: индексы **Соболя** $S_i,T_i$ на окрестности $\hat\theta$.

### 3.6. Валидация (out-of-fit)

* Держим часть метрик в «валидационный» набор (не включать в $\mathcal L$): напр. $\mu_{\rm proxy},\ v_{\rm cell}$, часть пиков, коллизии.
* **Posterior-predictive check**: $\mathbf m_{\rm mod}(\hat\theta)$ vs. $\mathbf m_{\rm obs}^{\rm val}$.

---

## 4. Частные постановки (e, p, n)

### 4.1. Электрон (e)

**Гипотеза:** одиночный $q=\pm1$, **без** цепочки ( $L=0$ или $1$ слабый слой ), EM-окно доминирует.

* **Priors (суженные):** $L\in\{0,1\}$, $\eta_\ell\le 0.05$, $|q|=1$.
* **Целевая подгонка:** $p$ (→ $\beta$), $J_r$ монотонен, $\mathcal A_\chi$ согласована по знаку, $M_{\rm eff}$ минимален среди {e,p,n}.
* **Валидируем:** малые/отсутствующие пики $Y(\omega)$, слабая локализация (большой $r_{\rm eff}$).

### 4.2. Протон (p)

**Гипотеза:** $q=+1$, **3–5 слоёв**, выраженные пики $Y$, высокий $\mathcal C$ ⇒ большой $M_{\rm eff}$.

* **Priors:** $L\in[3,5]$, $\eta_\ell\in[0.1,0.3]$, умеренный пиннинг $\gamma,\tau$.
* **Целевая:** согласовать ≥3 пика $\{\omega_n,Q_n\}$, сильная локализация ($\Pi_\rho\ge0.5$), $M_{\rm eff}$ максимален.
* **Валидируем:** стабильность каркаса при наложении мод (D1), низкие утечки между окнами (≤0.1).

### 4.3. Нейтрон (n)

**Гипотеза:** «каркас» как у p (сложный), но **EM-полевой след ≈ 0** (компенсация).

* **Priors:** $L\in[3,5]$, $\eta_\ell\in[0.1,0.3]$, **симметрия хиральности** ($\tau_{+q}\approx\tau_{-q}$) или геом. компенсация.
* **Целевая:** $|J_r|$ в хвосте ≪ p/e (задаётся порогом), пики $Y$ сопоставимы с p, $M_{\rm eff}$ близок к p (в тех же ед.).
* **Валидируем:** признак слабого EM-хвоста, отличия в $\mathcal A_\chi$ от p.

---

## 5. Метрики и критерии приёмки

### 5.1. Качество подгонки

* **Суммарная потеря** $\mathcal L(\hat\theta)\le \mathcal L_{\max}$ (порог задаётся в конфиге).
* **По компонентам:**
  — хвост: $|\hat p-(2\hat\beta-3)| \le 0.03$;
  — пики: $|\omega_n^{\rm mod}-\omega_n^{\rm obs}|/\omega_n^{\rm obs}\le 5\%$, $|Q_n^{\rm mod}-Q_n^{\rm obs}|/Q_n^{\rm obs}\le 10\%$ для ≥3 пиков (p/n) и «нет пиков ≥8 dB» (e);
  — карты: Жаккар «горячих зон» ≥ 0.8;
  — динамика: $|D|,|G|$ в пределах 10%, $M_{\rm eff}^{\rm freq}\approx M_{\rm eff}^{\rm imp}$ (≤10%).

### 5.2. Валидируемые (out-of-fit)

* **Энергобалансы:** невязка ≤3%; пассивность $P_\Omega\ge0$.
* **Хиральность/EM:** знак $\mathcal A_\chi$ верный; для n: $\max_R |J_r(R)|\le \epsilon_{\rm EM}$ (напр., 0.1 от p).
* **Коллизии (если даны):** классы исходов и углы — расхождение ≤ 15%.

### 5.3. Кросс-масштаб (опционально)

Если доступны **эталоны** (массы/моменты) — разрешается 2-точечная калибровка масштаба (например, опорой взять e и p), далее **прогноз n**: относит. ошибка предсказанного $M_{\rm eff}^{(n)}$ ≤ 15%. Если эталонов нет — использовать **только безразмерные** соотношения (e.g. $M_{\rm eff}^{(p)}/M_{\rm eff}^{(e)}$).

**Любое нарушение критерия → FAIL** с отчётом и указанием доминирующего вклада в $\mathcal L$.

---

## 6. Конфиги (JSON) — примеры

### G-e (электрон)

```json
{
  "case": "G_electron_inversion",
  "priors": {
    "beta": [0.6, 1.4],
    "layers_count": [0, 1],
    "eta": [[0.0, 0.05]],
    "gamma": [[0.0, 0.2]],
    "tau": [[0.5, 1.5]],
    "q_allowed": [1, -1]
  },
  "observables": "data/e/*.h5",
  "loss_weights": {"tail":1.0,"jr":1.0,"Achi":0.5,"peaks":0.5,"mobility":0.5,"Meff":1.0},
  "targets": {"peaks_expect_none_db": 8.0, "jr_monotonic": true},
  "opt": {"lhs_samples": 2000, "local_topk": 20, "seed": 42},
  "validate": {"holdout": ["mu_proxy","vcell"]},
  "output_dir": "out/G_e"
}
```

### G-p (протон)

```json
{
  "case": "G_proton_inversion",
  "priors": {
    "beta": [0.6, 1.4],
    "layers_count": [3, 5],
    "eta": [[0.1, 0.3],[0.1,0.3],[0.1,0.3],[0.1,0.3],[0.1,0.3]],
    "gamma": [[0.1, 0.8],[0.1,0.8],[0.1,0.8]],
    "tau":   [[0.5, 2.0],[0.5,2.0],[0.5,2.0]],
    "q_allowed": [1]
  },
  "observables": "data/p/*.h5",
  "loss_weights": {"peaks":2.0,"zones":1.0,"Meff":1.0,"mobility":0.5,"leakage":1.0},
  "targets": {"min_peaks": 3, "peak_prom_db": 8.0, "Pi_rho_min": 0.5},
  "opt": {"lhs_samples": 4000, "local_topk": 40, "seed": 42},
  "validate": {"holdout": ["mu_proxy"]},
  "output_dir": "out/G_p"
}
```

### G-n (нейтрон)

```json
{
  "case": "G_neutron_inversion",
  "priors": {
    "beta": [0.6, 1.4],
    "layers_count": [3, 5],
    "eta": [[0.1, 0.3],[0.1,0.3],[0.1,0.3]],
    "gamma": [[0.1, 0.8],[0.1,0.8],[0.1,0.8]],
    "tau":   [[0.5, 2.0],[0.5,2.0],[0.5,2.0]],
    "q_allowed": [0, 1]  // допускаем q=1 с EM-компенсацией
  },
  "observables": "data/n/*.h5",
  "loss_weights": {"peaks":1.5,"jr_cancel":2.0,"Meff":1.0,"Achi":1.0},
  "targets": {"jr_max_rel_to_p": 0.1, "min_peaks": 3},
  "opt": {"lhs_samples": 4000, "local_topk": 40, "seed": 43},
  "validate": {"holdout": ["collisions_map"]},
  "output_dir": "out/G_n"
}
```

---

## 7. Выходные данные и отчётность

* **Паспорта:** `passport_{e,p,n}.json` (таблица $\hat\theta$ с ДИ, метрики по разделам, флаги PASS/FAIL).
* **Файлы подгонки:** `fit_traces.h5` (история оптимизации), `postpred.h5` (posterior-predictive поля/спектры/динамика).
* **Графики:** `peaks_fit.png`, `A_tail_fit.png`, `jr_profiles.png`, `hotzones_jaccard.png`, `Meff_both_methods.png`.
* **Протокол:** `fit_report.md` (кратко: что вошло в loss, что в holdout, основные расхождения).
* **Журнал:** `runs.csv` (хэши конфигов/данных, seed, версия кода, PASS/FAIL).

---

## 8. Критерии приёмки (сводно)

* **Электрон:** нет пиков ≥ 8 dB; $J_r$ монотонен; $M_{\rm eff}$ — минимальный (внутр. сравнение).
* **Протон:** ≥3 согласованных пика ($\omega,Q$); $\Pi_\rho\ge 0.5$; низкие утечки; $M_{\rm eff}$ — максимальный.
* **Нейтрон:** пик-каркас как у p; хвост EM подавлен: $\max_R |J_r|\le 0.1 \times \max_R |J_r|_{\rm p}$.
* **Общее:** $M_{\rm eff}^{\rm freq}\approx M_{\rm eff}^{\rm imp}$ (≤10%); пассивность и балансы PASS; holdout-метрики в допусках.
* **Кросс-масштаб (если включён):** после 2-точечной калибровки по (e,p) — прогноз n в пределах 15%.

---

## 9. Численные предосторожности

1. Нормировать все метрики (z-score/robust) перед оптимизацией, чтобы веса $w_k$ были сопоставимы.
2. Следить за пассивностью: штраф/барьер при $\Re\Gamma_{\rm mem}<0$.
3. ABCD-модули использовать только в согласованном диапазоне частот (см. уровень C), вне — снижать вес «пиков».
4. Идентифицируемость: если $S_i$ мал для параметра — фиксировать его или ужимать приор.
5. Сходимость: проверять $\hat\theta$ на $N=256\to384$ (дрейф ≤5%).
6. Не «перекручивать» $\beta$ при попытке компенсировать ошибку слоёв — удерживать хвост в весе.

---

## 10. Структура репозитория

```
/core
  inverse_driver.py        # оркестратор инверсии (LHS -> локальный -> постпред)
  loss_metrics.py          # d_k, веса, нормировки, барьеры пассивности
  priors_regularizers.py   # priors, рег. геометрии и памяти
  forward_wrappers.py      # вызовы модулей A–F -> m_mod(θ)
  identifiability.py       # Соболь/Фишер
  postpred_checks.py       # holdout, сравнения, отчёт
/particles
  electron.json  proton.json  neutron.json  # базовые шаблоны
/tests
  test_G_electron.py
  test_G_proton.py
  test_G_neutron.py
  test_G_crossscale.py     # опц. 2-точечная калибровка и прогноз n
/configs
  G_e*.json  G_p*.json  G_n*.json
/data
  e/*  p/*  n/*         # наблюдаемые (или синтетика для отладки)
/out
  <паспорт, графики, отчёты>
```

---

## 11. Итог

“Уровень G” считается **выполненным**, когда для **e, p, n** выпущены паспорта с $\hat\theta$, все критерии раздела 8 **PASS**, а валидационные (holdout) метрики и энергетическая корректность подтверждены. Далее тем же конвейером можно проверять и иные «осколки/состояния» — как альтернативную интерпретацию зоопарка.


---

---
%%7d-38%%
---



Модельный отбор данных

Вот что делаем дальше.

# 1) Мини-дорожная карта (e, p, n → проверка теории)

* **Инверсия (уровень G)** для e/p/n: получаем $\hat\theta=\{\beta,L,(R_\ell,\eta_\ell),(\gamma_\ell,\tau_\ell),q\}$, $M_{\rm eff}$, $D,G$, $\{\omega_n,Q_n\}$, утечки между окнами.
* **Валидация “вне подгонки”**: держим часть метрик отдельно (магн. момент-прокси, дрейф, коллизии) и проверяем предсказания.
* **Критерий простоты**: AIC/BIC (или Bayes factor) на одном и том же наборе наблюдаемых — штраф за лишние параметры/слои. Модель выигрывает только если **лучше предсказывает holdout**.

# 2) Как отличать “эмергентные резонансы” от «новых частиц»

Вводим три жёстких теста (их легко автоматизировать поверх A–G):

1. **Универсальность**
   Эмергентный пик $Y(\omega)$ в нашей модели **дрейфует** при изменении среды ($\eta,\gamma,\tau,L$). Если реальный пик **инвариантен** к среде в пределах погрешности, — это не «наш» резонанс.
   *Реализация:* прогнать свипы (E1/E5) и построить $\partial\omega_n/\partial\eta$, $\partial Q_n/\partial\eta$. Порог: если $|\partial\omega_n/\partial\eta|<\varepsilon$ для всего диапазона, наш механизм **отвергнут** для этого сигнала.

2. **Форма и ширина**
   У нас $Q_n$ задаётся памятью ($\gamma,\tau$) и меняется с контрастом. Если наблюдаемая ширина линии **не меняется** при вариациях среды, — снова отвергаем эмергентную трактовку.
   *Реализация:* регрессия $Q_n(\eta,\tau)$, критерий плоскости/горизонтальности в пределах ДИ.

3. **Экология связей**
   В модели ВБП пики появляются цепочками (ABCD-композиция). Если в наблюдении изолированный «пик» никак не встраивается в согласованную цепочку и не даёт согласованной передачи на соседних частотах, — вероятность “новой частицы” мала.
   *Реализация:* сверка с $\mathbf T_{\rm tot}(\omega)$ (ур. C2): ошибка прогноза > порога → “вне-каркасный” объект.

# 3) Проверка тезиса «масса = сложность»

* **F2/F3 уже готовы**: извлекаем $M_{\rm eff}$ (частотный + импульсный) и строим зависимость от $\mathcal C$ (число мод, $Q$, контрасты, $|q|$).
* **Критерий**: устойчивый положительный наклон и $\rho,\rho_s\ge 0.7$ на семействе конфигураций (p > n? e — минимален). Если нет — тезис **ослабляется** или **отвергается**.

# 4) “Анти-эпицеклы”: как не настрелять ещё «десяток Хиггсов»

* **Замораживаем набор параметров** перед валидацией (никаких дозадач после просмотра holdout).
* **Сравниваем модели по AIC/BIC**:

  * M0: базовый ВБП без лишних слоёв,
  * M1: ВБП + ещё слой/память,
  * M2: «вставной резонанс» (аналитический Лоренц без физики).
    Побеждает только модель с **лучшим прогнозом** на holdout при меньшей/сравнимой сложности.
* **Фальсифицирующие ножи** (быстрые): несходится хвост $p=2\beta-3$; $M_{\rm eff}^{\rm freq}\not\approx M_{\rm eff}^{\rm imp}$; пиннинг не даёт заморозки при $\gamma>\gamma^\*$; не проходит энергетический баланс (F6). Любой — **STOP**.

# 5) Практический next-step

* Сформировать три каталога исходных данных **e/p/n** (или синтетику для отладки).
* Запустить **G-уровень** для каждого и собрать *паспорт*.
* Добавить модуль **model\_selection.py**: AIC/BIC, кросс-валидация, отчёт «универсальность/ширина/цепочка».
* Выпустить короткий отчёт: *годится/не годится* по каждому спорному «пику» с указанием, что именно не прошло (дрейф, форма, экология).

---

Итог: вместо “спорить про Хиггс”, мы ставим **автоматические, фальсифицируемые тесты**. Если эмпирические пики ведут себя как **эмергентные** (зависят от среды, входят в цепочку, ширина управляется потерями) — это «наши» каркасные моды. Если нет — честно фиксируем: **этот сигнал вне механизма ВБП**.


---


---
%%7d-39%%
---


Оттолкнёмся от ТЗ уровней A–D и соберём «скелет» классов. Ниже — **набор сущностей и их роли** (группами), с ключевыми связями. Этого достаточно, чтобы начертить UML-диаграмму (packages → классы → отношения).

# 1) Ядро физики/числа (core)

* **Domain**: тор $[0,L)^3$, периодические ГУ; хранит $L,N,\Delta$ и k-сетку. Используется в FFT и радиальном усреднении. &#x20;
* **Field**: комплексное поле $a(x,t)$ / $\hat a(k,\omega)$, тип данных float64.&#x20;
* **OperatorRiesz**: $\mathcal L_\beta=\mu(-\Delta)^\beta+\lambda$ и $\alpha_k=\nu|k|^{2\beta}+\lambda$. Даёт знаменатель $D(k)$ и применяет фракц. Лаплас в k-области. &#x20;
* **MemoryKernel** (Дебай-память): параметры $\gamma_j(x),\tau_j(x)$, частотная форма $\Gamma_{\rm mem}(x,\omega)=\sum \gamma_j/(1+i\omega\tau_j)$ с проверкой пассивности $\Re\Gamma_{\rm mem}\ge0$. &#x20;
* **Source** (иерархия):

  * *GaussianNeutralized* (квазиточечный): $s=g_\sigma-\bar g$, авто-нулевая мода при $\lambda=0$.&#x20;
  * *HarmonicSource* ($e^{-i\omega t}$), *TwoToneSource* (биения), *DipoleModulated* (вариант S1 для ABCD). &#x20;
* **FFTBackend**: прямой/обратный БПФ с согласованной нормировкой; проверка Parsevál. (из уровня A).&#x20;

# 2) Геометрия среды

* **SphericalLayer**: маска слоя $[R_\ell,R_\ell+\Delta R_\ell]$, хранит $\eta_\ell,\gamma_\ell,\tau_\ell$.&#x20;
* **LayerStack**: цепочка резонаторов (2–5 оболочек), порядок сборки.&#x20;
* **ReferenceBall**: $\mathcal R_{\rm ref}$ для «портовой» амплитуды/адмиттансы. (Уровни C/D используют $U_{\rm ref}$, $Y_\ell$).&#x20;

# 3) Решатели

* **StationarySolver**: $\widehat a=\widehat s/(\mu|k|^{2\beta}+\lambda+i\omega+\Gamma_{\rm mem})$. Работает по одной $\omega$ или серией.&#x20;
* **TimeSolver**: экспоненциальный интегратор / CN для $\partial_t a+\nu(-\Delta)^\beta a+\lambda a+\sum\gamma m=s$ + эволюция $m_j$. &#x20;
* **FrequencySweep**: лог-шаг + доуточнение на пиках $Y(\omega)$.&#x20;

# 4) ABCD/передача

* **AdmittanceEstimator**: вычисляет $Y_\ell(\omega)$ в слоях, проминенсы/пики, $Q_n$. (см. C-уровень, блок 4.)&#x20;
* **LayerTransferMatrix** ($\mathbf T_\ell$): идентификация по S0/S1;
  **TransferChain**: $\mathbf T_{\rm tot}=\prod \mathbf T_\ell$, валидация с прямым расчётом.&#x20;

# 5) Прокси-поля и окна (уровень D)

* **EnvelopeProxies**: $A=|A|e^{i\phi}$, $\mathbf K=\nabla\phi$, $\mathbf j=\Im(\bar A\nabla A)=|A|^2\nabla\phi$, $I=|A|^2$, $I_{\rm eff}$ (скользящее усреднение). Метрики инвариантны к масштабу и глобальной фазе. &#x20;
* **WindowEM/STR/WEAK** (enum + параметры полосы/амплитуды/хиральности): правила отбора частот и режимов.&#x20;
* **LeakageProjector**: $\mathrm{Leak}_{X\to Y}=\|\mathcal P_Y(A_X)\|_2/\|A_X\|_2$. Критерии раздельности окон.&#x20;

# 6) Аналитика/метрики

* **RadialAverager**: $A(r)$, биннинг, сглаживание S-G.&#x20;
* **TailSlopeEstimator**: лог-лог регрессия, $\hat p$ и $R^2$.&#x20;
* **MonotonicityChecker**: счёт изменений знака $A'(r)$ (отсутствие стоячих сфер).&#x20;
* **PhaseWinding**: обмотка фазы по контуру $\hat q$ (2D/сечение 3D).&#x20;
* **ZoneDetector**: $r_{\rm core},r_{\rm tail}$ по индикаторам/порогам (ядро/переход/хвост). &#x20;
* **HotZonesMask**: $H_0,H_k$ (топ-p% по $I_{\rm eff}$), **JaccardIndex** для стабильности каркаса.&#x20;
* **FluxRadial**: $J_r(R)=\langle \tilde{\mathbf j}\!\cdot\!\mathbf n\rangle_{S(R)}$, монотонность и инвариантность масштаба.&#x20;
* **LocalizationMetrics**: $\Pi_\rho$, $r_{\rm eff}$ (локализация STR).&#x20;
* **ChiralityMetrics**: $\ell_z$, $\mathcal A_\chi$ и управление через $\tau_{\pm q}$. &#x20;
* **PassivityPower**: $P_\Omega(\omega)\ge0$ (энергобаланс/пассивность).&#x20;

# 7) Эксперименты/сценарии и критерии приёмки

* **ExperimentCase** (A0…D4): конфиг, запуск решателей/свипов, сбор артефактов, критерии PASS/FAIL. &#x20;
* **AcceptanceCriteria**: пороги по пикам $Y(\omega)$, $Q_n$, Жаккар, утечки, монотонность $J_r$, инвариантность масштаба и т.д. &#x20;
* **SweepManager**: по $\beta,\eta,\gamma,\tau,\omega$ (лог-шаг + уточнение).&#x20;
* **Artifacts/Report**: $Y(\omega),\ \{\omega_n,Q_n\}$, карты $I,I_{\rm eff}$, графики, JSON-отчёты.&#x20;

# 8) Пакет «Каркас/EM-STR-WEAK»

* **Skeleton**: определение каркаса через $I_{\rm eff}$ и пики $Y_\ell$.&#x20;
* **OverlayManager**: наложение мод на каркас (D1), слежение за $\delta\omega_n,\delta Q_n$.&#x20;
* **WindowSelector**: классификация режима в EM/STR/WEAK и вычисление раздельности (Leak). &#x20;

# 9) Связи (схематично)

* `ExperimentCase` **агрегирует** `Domain`, `Source`, `OperatorRiesz`, `LayerStack`, `Solver(Stationary|Time)`, `Analyzers(*)`, `AcceptanceCriteria`.
* `LayerStack` **содержит** `SphericalLayer{1..5}` и настраивает `MemoryKernel` по слоям.
* `AdmittanceEstimator` ↔ `LayerTransferMatrix` ↔ `TransferChain` (ABCD-валидация).
* `EnvelopeProxies` → `FluxRadial`, `HotZonesMask`, `ChiralityMetrics`, `LeakageProjector`.
* `FrequencySweep` использует `StationarySolver` и публикует данные в `AdmittanceEstimator`/`PeaksFinder`.
* Все анализаторы читают `Field/FFTBackend/Domain`, пишут в `Artifacts/Report`.

---

Ок. Ниже **ASCII-скелет UML**: пакеты, классы и связи. Коротко и структурно.

```
Легенда:
  <|--   наследование            o--   агрегация (слабая)
  *--    композиция (жёсткая)    -->   ассоциация/использование
  ==     границы пакета
```

# CORE

```
== core ===========================================================
+ Domain(L,N,Δ,kgrid)
+ Field(data: complex64/128)
+ FFTBackend(plan_fwd, plan_inv)
+ OperatorRiesz(ν,β,λ)
+ MemoryKernel[{γ(x),τ(x)}]
+ Source (abstract)
    <|-- GaussianNeutralized(σ)
    <|-- HarmonicSource(ω)
    <|-- TwoToneSource(ω1,ω2)
    <|-- DipoleModulated(ε,dir)

Domain --> FFTBackend
Field  --> FFTBackend
OperatorRiesz --> Domain
MemoryKernel  --> Domain

Source --> Domain
===================================================================
```

# GEOM

```
== geom ===========================================================
+ SphericalLayer(R, dR, η, γ, τ)
+ LayerStack(layers: SphericalLayer[ ])
+ ReferenceBall(Rref)

LayerStack *-- SphericalLayer
LayerStack --> MemoryKernel
ReferenceBall --> Domain
===================================================================
```

# SOLVERS

```
== solvers ========================================================
+ StationarySolver(domain, op:OperatorRiesz, mem:MemoryKernel)
+ TimeSolver(domain, op:OperatorRiesz, mem:MemoryKernel)
+ FrequencySweep(solver:StationarySolver, ω-grid)

FrequencySweep --> StationarySolver
StationarySolver --> {Domain, OperatorRiesz, MemoryKernel, Source, FFTBackend}
TimeSolver      --> {Domain, OperatorRiesz, MemoryKernel, Source, FFTBackend}
===================================================================
```

# ABCD / ПЕРЕДАЧА

```
== abcd ===========================================================
+ AdmittanceEstimator(Uref, shells)
+ LayerTransferMatrix(Tℓ(ω): 2x2)
+ TransferChain(Ttot(ω))
+ PeaksFinder(prom_db)

AdmittanceEstimator --> {Domain, LayerStack, StationarySolver}
PeaksFinder         --> AdmittanceEstimator
LayerTransferMatrix --> {RadialState, dual-runs S0/S1}
TransferChain  *--  LayerTransferMatrix
===================================================================
```

# ANALYSIS (метрики, окна)

```
== analysis =======================================================
+ RadialAverager -> A(r), A_r(r)
+ TailSlopeEstimator -> p, R²
+ MonotonicityChecker(A') -> no-stand-waves
+ PhaseWinding -> q
+ ZoneDetector -> {r_core, r_tail}
+ HotZonesMask -> H(x), top-p%
+ JaccardIndex(H0,Hk)
+ EnvelopeProxies -> {φ, ∇φ, j=Im(Ā∇A), I, I_eff}
+ FluxRadial -> Jr(R)
+ LocalizationMetrics -> {Πρ, r_eff}
+ ChiralityMetrics -> {ℓ_z, A_χ}
+ LeakageProjector -> Leak_{X→Y}
+ PassivityPower -> P_Ω(ω)≥0
+ RadialState(A(R), A_r(R))

{RadialAverager, TailSlopeEstimator, ...} --> {Field, Domain}
EnvelopeProxies --> Field
FluxRadial      --> EnvelopeProxies
HotZonesMask    --> EnvelopeProxies
LeakageProjector--> {WindowSelector, EnvelopeProxies}
===================================================================
```

# WINDOWS / CARCASS

```
== windows ========================================================
+ WindowSelector(EM/STR/WEAK, bands, spatial filters)
+ Skeleton(carcass from I_eff + Y-peaks)
+ OverlayManager(track δω_n, δQ_n)

WindowSelector --> {PeaksFinder, EnvelopeProxies}
Skeleton      --> {HotZonesMask, AdmittanceEstimator}
OverlayManager--> {Skeleton, PeaksFinder}
===================================================================
```

# EXPERIMENTS / ACCEPTANCE

```
== experiments ====================================================
+ ExperimentCase(id, config)
+ AcceptanceCriteria(thresholds)
+ SweepManager(params: β,η,γ,τ,ω,...)
+ Artifacts(paths)
+ Report(md/json)

ExperimentCase o-- {Domain, LayerStack, Source, StationarySolver,
                    TimeSolver, FrequencySweep, Analysis*, ABCD*}
ExperimentCase *-- AcceptanceCriteria
ExperimentCase *-- {Artifacts, Report}
SweepManager   --> ExperimentCase
===================================================================
```

# DYNAMICS (ур. F)

```
== dynamics =======================================================
+ Trap(K, radius) / Drive(type, Fx) / Kick(κ, Δt)
+ Tracker -> X(t), V(t), A(t)
+ MobilityGyro -> {D,G} via steady drift
+ MassEstimators -> M_eff (freq & impulse)
+ Collisions -> outcomes(b, V0, Δφ)
+ EnergyBalance -> E(t), P_s, P_diss, radiation

{Trap,Drive,Kick} --> TimeSolver
Tracker           --> Field
MobilityGyro      --> Tracker
MassEstimators    --> {Tracker, Drive, Trap}
Collisions        --> {TimeSolver, Tracker}
EnergyBalance     --> {Field, Source, MemoryKernel}
===================================================================
```

# INVERSION (ур. G)

```
== inversion ======================================================
+ InverseDriver
+ LossMetrics(L(θ))
+ PriorsRegularizers
+ ForwardWrappers -> m_mod(θ) (A–F)
+ Identifiability -> {Sobol S_i, T_i}
+ PostpredChecks (holdout)
+ ParticleTemplate(e/p/n)
+ ParticlePassport(θ̂, CI, verdict)

InverseDriver o-- {PriorsRegularizers, LossMetrics, ForwardWrappers,
                   Identifiability, PostpredChecks}
ParticlePassport <-- InverseDriver
ForwardWrappers  --> {solvers, analysis, abcd, dynamics}
===================================================================
```

# ВЕРХНЕУРОВНЕВАЯ СВЯЗКА ПАКЕТОВ

```
[experiments] --> [solvers] --> [core]
[experiments] --> [analysis] --> [core]
[experiments] --> [abcd]     --> [analysis]
[windows]     --> [analysis]
[dynamics]    --> [solvers],[analysis]
[inversion]   --> [experiments],[solvers],[analysis],[abcd],[dynamics]
[geom]        --> [core]  and used by [solvers]/[experiments]
```


---

